{"icon":"other","settings":{"router":{"mode":"intelligent","animation":"off"},"theme":"default","push-notifications":{"android":{"enabled":true,"id":"5299203052"},"ios":{"enabled":true},"wp":{"enabled":false}},"loading-message":true},"name":"LSER_Consumer","version":"0.0.1","pages":[{"name":"Chat","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"event":"onload","type":"start-timer","data":{"name":"checkExpireMessages"},"_auto_id_":"77a94855-cffb-4f47-acd1-6a900acf1b43"},{"event":"onload","type":"set-variable","data":{"name":"loading_spinner","value":"false"},"_auto_id_":"41c88938-60c5-4fba-b14e-1c5f7ec15c25"}],"_auto_id_":"029c2e91-016d-460e-9fd6-3e45d871bd6d"}],"content":[{"name":"title_bar_2","type":"navigation","item-type":"title-bar","content":[{"name":"title_2","type":"content","item-type":"title","content":"<h1>{{'$store.variables.stationServer' | store}} - Live Feed</h1>","_auto_id_":"fafc37e8-0dee-49a7-b9c1-3dea668db6fe"},{"name":"logout_btn","type":"control","item-type":"button","content":"","theme":"minimal","left-icon":"fa-sign-out","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"  var popup = document.getElementById('popChatLogout');\n  popup.togglePopup();"},"_auto_id_":"1721471e-7531-4ac5-aaf7-2419b686cbfe"}],"expressions":{},"_auto_id_":"c18c2eac-e9f9-4a5f-95b6-b81bf21829b0"}],"extends":{"type":"area","item-type":"row"},"expressions":{},"_auto_id_":"da405156-25b2-4269-a0ad-8a865e7c6679"},{"name":"status_bar_con","type":"area","item-type":"static","content":[{"name":"status_bar_chat","type":"content","item-type":"html","content":"<span>Up to Date</span>","expressions":{},"_auto_id_":"9474ef18-5924-46b9-85d3-0e90425d6b43"}],"expressions":{},"_auto_id_":"32021d9e-0b76-497b-bcb0-68821f79b584"},{"name":"chat_section","type":"area","item-type":"scrollable","content":[{"name":"spinner","type":"content","item-type":"html","content":"<div class=\"loadingspinner fa-pulse\"></div>","expressions":{"show":"$store.variables.loading_spinner == true"},"_auto_id_":"c486fae4-893d-46f0-95c3-e9eacdf68284"},{"name":"chat_list","type":"content","item-type":"list","title":"List","edit":false,"search":false,"row":"<div ng-show=\"$data.$item.station.indexOf($store.variables.currentStation) > -1\"  ng-click=\"$store.variables.index = $item.$index\" ng-class=\"($data.$item.expired == 'true') ? 'close-msg' : ''\" class=\"msg-container\">\n    <div class=\"clearfix info-top\"></div>\n    <div class=\"priority-container\">\n        <span class=\"{{$data.$item.priority}}-priority\"></span>\n    </div>\n    <div class=\"msg-data-container\">\n        <span class=\"message-title\">{{$data.$item.title}}</span>\n\t\t<span class=\"message-timestamp\" ng-show = \"$data.$item.expired != 'true'\">{{$data.$item.last_update.time}}</span>\n\t\t<span class=\"message-timestamp\" ng-show = \"$data.$item.expired == 'true'\">Closed</span>\n        <span class=\"message-tagline\">{{$data.$item.tagline}}</span>\n        <span class=\"message-cancel-update\" ng-show = \"$data.$item.expired == 'true'\">Closed: View Details</span>\n        <span class=\"message-empty\"></span>\n    </div>\n</div>","classes":"chat-list-item","content":[],"theme":"","expressions":{},"actions":[{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"var data = $data.$item;\nconsole.log(data);\n//Reply back to the user that has sent back the message\nvar contact = data.from;\ncti.store.variables.currentContact = contact;\n\nvar messageParent = [data];\nvar messageChildren = data.history;\n\ncti.store.variables.audio_enabled = false;\ncti.store.variables.photo_enabled = false; \ncti.store.variables.message_enabled = false;\n\nvar responseRequired = data.response_required;\nvar responseType = data.response_type;\nvar threadId = data.thread_id;\n\nconsole.log(responseType);\n\nif(responseType){\n  for (i=0; i < data.response_type.length; i++){\n    switch(data.response_type[i]){\n      case \"audio\": cti.store.variables.audio_enabled = true; \n      break;\n      case \"photo\": cti.store.variables.photo_enabled = true; \n      break;\n      case \"message\": cti.store.variables.message_enabled = true; \n      default: break;\n    }\n  }\n}\n\nif (responseRequired == \"no\"){\n\tcti.store.variables.responseRequired = false; \n}\nelse {\n\tcti.store.variables.responseRequired = true;\n\tcti.store.variables.responseType = responseType;\n}\n\n\ncti.store.variables.currentThreadId = threadId;\ncti.store.variables.showReply = \"false\";\ncti.store.variables.advOptions = false;\n  \ncti.store.variables.messageParent = messageParent;\ncti.store.variables.messageChildren = messageChildren;\n  \ncti.utils.callAction(\"go-to-page\", \"Chat_Child\");\nthis.$success();","sync":true},"_auto_id_":"24a1d540-0789-434e-a7f8-bd7d726e1748"}],"model":"$store.userChats","_auto_id_":"ccc8f0d9-b354-419c-82a9-b40b46dc340a"},{"name":"html_9","type":"content","item-type":"html","content":"<p>No Open Incidents</p>","expressions":{"show":"$store.userChats < 1 || $store.userChats == undefined"},"_auto_id_":"cf8a9c13-c24f-4be1-888e-079248ca284f"},{"name":"popupChatExit","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"html_10","type":"content","item-type":"html","_auto_id_":"452b8448-e5d3-4061-b6ad-bc056c67e3be","content":"<span class=\"logoutPopText\">Are you sure you wish to log out?</span>"},{"name":"button_4","type":"control","item-type":"button","_auto_id_":"9e992043-bbab-49d1-88b2-0bd047daacd6","content":"LOG OUT","theme":"default","expressions":{},"classes":"accept","actions":[{"event":"click","type":"set-variable","data":{"name":"loading_spinner","value":"true"},"_auto_id_":"da37d9e8-3996-43b7-beb1-690d55bf674d"},{"event":"click","type":"stop-timer","data":{"name":"checkExpireMessages"},"_auto_id_":"988afbe3-cf3c-4b08-a1e9-5a2e9bc6b8d2"},{"event":"click","type":"xmpp-logout","data":{"name":"southeastern"},"_auto_id_":"c674dff2-bee9-4a12-8bea-652d38977394"},{"event":"click","type":"inline-function","data":{"sync":false,"code":"  var popup = document.getElementById('popChatLogout');\n  popup.togglePopup();"},"_auto_id_":"febfaece-c47f-4508-9e87-7bae1bcc70c2","actions":[]},{"event":"click","type":"go-to-page","data":"Login","_auto_id_":"f3035e82-d5f0-4ac2-85cb-127d96451b87"}]},{"name":"button_5","type":"control","item-type":"button","_auto_id_":"6532a529-b0e1-4504-872e-e3960b370a8c","content":"CANCEL","theme":"default","expressions":{},"classes":"cancel","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"  var popup = document.getElementById('popChatLogout');\n  popup.togglePopup();"},"_auto_id_":"ffda2d47-f25a-4cb3-b6e2-cdf730709f0c"}]}],"component":"ct_popup_box","_auto_id_":"01ae8a32-1101-4fb3-9538-a9ed096b3310","attributes":{"id":"popChatLogout"},"expressions":{}}],"expressions":{},"_auto_id_":"5631a697-1d2f-4a63-8304-7465c7b46807"},{"name":"bottomBar","type":"area","item-type":"row","content":[{"name":"doNotButton","type":"control","item-type":"button","content":"Do Not Disturb","theme":"default","expressions":{"disabled":"variables.loading_spinner == true"},"actions":[{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"Set_Do_Not_Disturb","_auto_id_":"939dd1d6-7a20-4843-aa3c-3842994733a0"}],"_auto_id_":"a35582df-3cc5-414a-8a7a-711d48dd2e59"}],"expressions":{},"_auto_id_":"bcc87809-10ea-43bc-b38d-862be29e90e9"}],"start":false},{"name":"Login","start":true,"config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"name":"call_function_1","event":"onload","type":"call-function","data":{"name":"setupApp"},"_auto_id_":"69773174-0823-47b7-87c1-0567f0f0943a"},{"event":"onload","type":"set-variable","data":{"name":"loading_spinner","value":"false"},"_auto_id_":"3e4438a0-9a73-4fbc-9d7b-c92329477218"}],"_auto_id_":"9d267e6f-5079-4f7d-a741-ddf74f36b439"}],"content":[{"name":"loginContainer","type":"area","item-type":"scrollable","content":[{"name":"upperLoginText","type":"content","item-type":"html","content":"<h1 class=\"mainTitle\">esia</h1>\n<h2 class=\"titleUnderText\">Employee Service Information App<h2>","expressions":{},"_auto_id_":"cbc78142-be86-4083-b9dd-7ed45b82caa2"},{"name":"username","type":"question","item-type":"text","_auto_id_":"b87f286f-f792-40e4-ba50-36764ab34ec5","label":"","required":false,"multiline":false,"debounce":250,"expressions":{}},{"name":"password","type":"question","item-type":"password","label":"","required":false,"expressions":{},"validators":[],"actions":[],"message":"This is a required field","_auto_id_":"88f3c4b9-6a69-4e76-9757-811695d19780"},{"name":"spinner","type":"content","item-type":"html","content":"<div class=\"loadingspinner fa-pulse\"></div>","expressions":{"show":"$store.variables.loading_spinner == true"},"_auto_id_":"bb2609f0-e93f-484a-a660-02a43fd0982a"},{"name":"row_10","type":"area","item-type":"row","content":[{"name":"login_btn","type":"control","item-type":"button","content":"Sign In","theme":"default","expressions":{"disabled":"$store.variables.loading_spinner == true || $store.pages.Login.username == undefined || $store.pages.Login.username.length == 0 || $store.pages.Login.password == undefined || $store.pages.Login.password.length == 0"},"actions":[{"event":"click","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"login_initiated","title":"Attempting Login..."},"_auto_id_":"b9b9f731-0832-4853-baf1-6c381133121f"},{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"var login;\nlogin = cti.store.pages.Login.username.toLowerCase();\ncti.store.variables.username = login;"},"_auto_id_":"8d6d968d-625d-4402-8deb-dca519dd0f3e"},{"event":"click","type":"set-variable","data":{"name":"loading_spinner","value":"true"},"_auto_id_":"450ce8ed-e175-414f-827a-b106e069a85a"},{"event":"click","type":"xmpp-login","data":{"name":"southeastern","username":"{{$store.variables.username}}","password":"{{$store.pages.Login.password}}"},"_auto_id_":"0e089fd0-90b7-4b5c-b51d-c79216ded28a"},{"event":"click","type":"call-function","data":{"name":"registerWithHub"},"_auto_id_":"e39e0fa3-13a4-41c4-910b-58f203011465"},{"type":"if","data":{},"operations":[{"type":"value","content":"{{$store.variables.loggedInUser}}"},{"type":"operator","content":"!="},{"type":"value","content":"{{Login.username}}"}]},{"event":"click","type":"call-function","data":{"name":"azureUpdate","params":{"username":"{{$store.variables.username}}"}},"_auto_id_":"4ac68728-a6fd-4999-910a-f5eb33dfe55a"},{"type":"end-if","data":{},"operations":[]},{"name":"set_variable_3","event":"click","type":"set-variable","data":{"name":"loggedInPassword","value":"{{$store.pages.Login.password}}"},"_auto_id_":"d993c496-0e2e-4abf-bc26-dd74524b4ea3"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"//Clear the old data if this a new user logging into the device\nif (cti.store.variables.username != cti.store.variables.loggedInUser){\n    cti.store.userChats = [];\n}\n$success();    "},"_auto_id_":"c978a6c5-7956-4950-9f97-c05387216374"},{"name":"set_variable_1","event":"click","type":"set-variable","data":{"name":"loggedInUser","value":"{{$store.variables.username}}"},"_auto_id_":"1d168be9-3d26-4796-94b6-e3545997cde5"},{"event":"click","type":"inline-function","data":{"code":"var user = cti.store.variables.loggedInUser;\nvar pass = cti.store.variables.loggedInPassword;\n\nvar toEncode = user+\":\"+pass;\ncti.store.variables.userInfo = \"Basic \"+window.btoa(toEncode);\n\n//reset the serverLocation variable\ncti.store.variables.stationServer = \"No Previous Station Selected\";\n\n//remove expired messages\ncti.removeExpireMessages();\n$success();","sync":true},"_auto_id_":"62f51e6b-b2e1-43ac-a261-606d5cf691b2"},{"event":"click","type":"call-function","data":{"name":"XMPP_LoginOutcome"},"_auto_id_":"e4ae96d6-96d7-4a1f-a5c6-767229f44741"}],"_auto_id_":"7dbda841-43c0-40e3-8d39-7d7f62b528a6"}],"expressions":{},"_auto_id_":"8627d2f5-70c0-46cd-8cf8-8efd975a5c7d"},{"name":"button_13","type":"control","item-type":"button","content":"Dev - Clear Data","theme":"default","actions":[{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"var localStorageService = localStorage;\nvar appName = cti.store.schema.name; \n\nvar store = cti.store;\n\n//Delete route stack\nlocalStorageService.removeItem(appName + \"_stack\");\n//Delete app data\nvar db = new PouchDB(appName);\ndb.destroy().then(function(){\n  //Success\t\n  window.location.reload();\n}).catch(function(){\n  $log.error(\"Couldn't remove PouchDB database for '\" + appName + \"'\");\n});\n  "},"_auto_id_":"e1840a82-ce90-437c-83a3-6b68fcfd583b"}],"expressions":{"show":"variables.debugMode == true"},"_auto_id_":"be70c1d5-5c64-4db6-9d49-e6a208e744d1"},{"name":"bottomLoginText","type":"content","item-type":"html","content":"<p class=\"southEastern\">south<span class=\"southEasternBlue\">eastern</span></p>\n<p class=\"notice\">By using this app, you agree to the Terms, Cookie Policy and Privacy Policy</p>\n<p class=\"notice\">version 0.00.48</p>","expressions":{},"_auto_id_":"2c267d8d-1f3e-4a3f-92d9-836481f90c86"}],"expressions":{},"_auto_id_":"3564dcab-2019-4a16-a762-551526da2ea2"}]},{"name":"Chat_Child","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"event":"onload","type":"set-variable","data":{"name":"photo_panel_open","value":"false"},"_auto_id_":"11f58794-e621-4b45-93e0-7b6277eefb9c"},{"event":"onload","type":"set-variable","data":{"name":"audio_panel_open","value":"false"},"_auto_id_":"451f89b6-6da1-4ed4-b3b8-d82180accfff"},{"event":"onload","type":"set-variable","data":{"name":"msg_panel_open","value":"false"},"_auto_id_":"8d7b83bf-c6b6-4ff6-bbab-94155b34bf1e"},{"event":"onload","type":"set-variable","data":{"name":"show_mic_icon","value":"false"},"_auto_id_":"1c736a97-0531-47de-b660-559d5dce25e3"},{"event":"onload","type":"set-variable","data":{"value":"false","name":"audioRecordedShow"},"_auto_id_":"9066b718-fc19-4e58-92ed-32a7f0449953"}],"_auto_id_":"93d20a78-8525-43f2-b6e7-025c470f696a"}],"content":[{"name":"title_bar_3","type":"navigation","item-type":"title-bar","content":[{"name":"back_btn","type":"control","item-type":"button","content":"","theme":"default","left-icon":"fa-arrow-circle-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"code":"cti.store.variables.photo_panel_open = false;\ncti.store.variables.audio_panel_open = false;\ncti.store.variables.msg_panel_open = false;\n\ncti.store.variables.imageShow = false;\ncti.store.variables.audioShow = false;\ncti.store.variables.messageShow = false;\n\ncti.store.variables.disablePhoto = false;\ncti.store.variables.disableAudio = false;\ncti.store.variables.disableMessage = false;\n\n$('#send_audio .fa-microphone').removeClass('selected');\n$(\"#send_img .fa-camera\").removeClass('selected');\n$(\"#send_msg .fa-envelope\").removeClass('selected');\n"},"_auto_id_":"6ea3d89c-289e-460c-9093-2b5c1016c0d5"},{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"Chat","_auto_id_":"b72df73d-6441-48c9-a7e4-2c7e49dd8c43"}],"_auto_id_":"343c0bcc-f24f-4896-bebe-113b149da4cc"},{"name":"title_3","type":"content","item-type":"title","content":"<h1>Incident Updates</h1>","expressions":{},"_auto_id_":"9871adfb-c48b-4133-a48f-2af7508263d5"}],"extends":{"type":"area","item-type":"row"},"expressions":{},"_auto_id_":"5a66a3c3-f276-4c36-bbd4-aa1adca59750"},{"name":"chat_parent_con","type":"area","item-type":"static","content":[{"name":"chat_parent","type":"content","item-type":"list","title":"List","edit":false,"search":false,"row":"<div>\n<div class=\"main-msg-container\" ng-class=\"($data.$item.expired == 'true') ? 'close-msg' : ''\">\n\t<span class=\"status-bar\" ng-show = \"$data.$item.expired != 'true'\">Up to Date</span>\n\t<span class=\"status-bar\" ng-show = \"$data.$item.expired == 'true'\">Message Closed - Expires after {{$data.$item.expired_time}}</span>\n    <div class=\"clearfix info-top\"></div>\n    <div  class=\"main-priority-container\">\n        <span class=\"{{$data.$item.priority}}-priority\" ></span>\n    </div>\n    <div class=\"main-msg-data-container\">\n\t\t<div class=\"main-msg-content-container\">\n\t\t\t<span class=\"message-title\">{{$data.$item.title}}</span>\n\t\t\t<span class=\"message-tagline\">{{$data.$item.tagline}}</span>\n\t\t\t<span class=\"message-user\">Southeastern Control:</span>\n\t\t\t<div class=\"message-parent-body\">\n\t\t\t\t<span class=\"message-content\" ng-show= \"$data.$item.body\">{{$data.$item.body}}</span>\n\t\t\t\t<span item=\"{{$data.$item}}\" class=\"msg-image\" ontouchstart=\"cti.imageView(this)\" onclick=\"cti.imageView(this)\">\n\t\t\t\t\t<!-- <image-viewer ng-show=\"$data.$item.original[0].media.local != null && $data.$item.original[0].media.type != null && $data.$item.original[0].media.type.indexOf('image') > -1\" src=\"{{$data.$item.original[0].media.local}}\"></image-viewer> -->\n\t\t\t\t\t<img md-thumbnail=\"{{$data.$item.original[0].media.local}}\" md-thumbnail-maxwidth=\"200\" md-thumbnail-maxheight=\"200\" />\n\t\t\t\t</span>\n\t\t\t\t<span class=\"msg-audio\">\n\t\t\t\t\t<audio-player ng-show=\"$data.$item.original[0].media.local != null && $data.$item.original[0].media.type != null && $data.$item.original[0].media.type.indexOf('audio') > -1\" src=\"{{$data.$item.original[0].media.local}}\"></audio-player>\n\t\t\t\t</span>\n\t\t\t\t<div id=\"message-confirm\" class\"=message-confirm\" ng-show=\"$data.$item.confirm_message == 'true'\">\n\t\t\t\t\t<span class=\"message-confirm-title\">Confirmation Needed</span>\n\t\t\t\t\t<span class=\"message-confirm-content\">I have read/listened to this message and understand fully</span>\n\t\t\t\t\t<span item=\"{{$data.$item}}\" id=\"confirmButton\" class=\"confirmButton\" ontouchstart=\"cti.confirmMessage(this)\" onclick=\"cti.confirmMessage(this)\">I Confirm</span>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"message-parent-timestamp\">Received at: {{$data.$item.last_update.time}}</span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n</div>","classes":"","expressions":{},"content":[],"model":"$store.variables.messageParent","actions":[],"_auto_id_":"29ef6401-4d1b-4507-80c0-7d4191515066"}],"expressions":{},"_auto_id_":"c697d413-f69d-4231-85a5-e2f192831d66"},{"name":"chat_section","type":"area","item-type":"scrollable","content":[{"name":"chat_list","type":"content","item-type":"list","title":"List","edit":false,"search":false,"row":"<div>\n<div item=\"{{$data.$item}}\" index=\"{{$data.$item.$index}}\" id=\"child-msg-container[{{$data.$item.$index}}]\" class=\"child-msg-container {{$data.$item.list_class}}\" ng-click=\"$store.variables.index = $data.$item.$index\">\n\t<div ng-class=\"($data.$item.from == $store.variables.loggedInUser) ? 'user-blue' : 'user-white'\">\n\t\t<div class=\"main-timestamp-container\">\n\t\t\t<span>{{$data.$item.ts | date:'HH:mm'}}</span>\n\t\t</div>\n\t\t<div class=\"replyInfo\">\n\t\t\t<span ng-show=\"$data.$item.from != $store.variables.loggedInUser\"><strong>User:{{$data.$item.from.split(\"@\")[0]}} Replied </strong>via {{$data.$item.metadata.reply_type}}</span>\n\t\t\t<span ng-show=\"$data.$item.from == $store.variables.loggedInUser\"><strong>You Replied </strong>via {{$data.$item.metadata.reply_type}}</span>\n\t\t\t<span class=\"down-chevron\"></span>\n\t\t</div>\n\t</div>\n\t<div id=\"child-message-body[{{$data.$item.$index}}]\" class=\"child-message-body\">\n\t\t\t<!-- <image-viewer ng-show=\"$data.$item.media.local != null && $data.$item.media.type != null && $data.$item.media.type.indexOf('image') > -1\" src=\"{{$data.$item.media.local}}\"></image-viewer> -->\n\t\t\t<img md-thumbnail=\"{{$data.$item.media.local}}\" md-thumbnail-maxwidth=\"200\" md-thumbnail-maxheight=\"200\" />\n\t\t\t<audio-player ng-show=\"$data.$item.media.local != null && $data.$item.media.type != null && $data.$item.media.type.indexOf('audio') > -1\" src=\"{{$data.$item.media.local}}\"></audio-player>\n\t\t\t<span class=\"text\" ng-show=\"$data.$item.body\">{{$data.$item.body}}</span>\n\t</div>\n\t<div class=\"clearfix info-bottom\">\n\t\t<span ng-show=\"$data.$item.from == $store.variables.loggedInUser\" class=\"label {{($data.$item.status == 'displayed') ? 'success' : 'label-default'}}\" ng-switch=\"$data.$item.status\">\n\t\t\t<span ng-switch-default>{{$data.$item.status}}</span>\n\t\t\t<span ng-switch-when=\"displayed\">read</span>\n\t\t</span>\n\t\t<span class=\"label {{($data.$item.media_status == 'uploaded' || $data.$item.media_status == 'downloaded') ? 'success' : 'label-default'}}\">{{$data.$item.media_status}}</span>\n\t</div>\n</div>\n</div>","classes":"chat-list-item","content":[],"theme":"","expressions":{},"actions":[],"model":"$store.variables.messageChildren","_auto_id_":"7a9f596f-7218-4362-96e3-6cbe287ab579"}],"expressions":{},"_auto_id_":"ef3bfcb4-1135-4c60-9e4e-d8adff54f653"},{"name":"chatContainer","type":"area","item-type":"static","content":[{"name":"row_8","type":"area","item-type":"static","content":[{"name":"html_2","type":"content","item-type":"html","content":"","expressions":{},"_auto_id_":"d42df386-56ca-48cd-a6e1-f084806433ac"},{"name":"send_img","type":"control","item-type":"button","content":"","theme":"minimal","right-icon":"fa-camera","actions":[{"type":"if","data":{},"operations":[{"type":"value","content":"{{$store.variables.imageShow}}"},{"type":"operator","content":"=="},{"type":"value","content":"false"}]},{"event":"click","type":"set-variable","data":{"name":"imageShow","value":"true"},"_auto_id_":"ed0a3de5-9376-431b-b42a-0d3207ed7c5a"},{"event":"click","type":"set-variable","data":{"name":"photo_panel_open","value":"true"},"_auto_id_":"657332c8-bc54-4e30-98b0-c3711da07afb"},{"event":"click","type":"inline-function","data":{"code":"cti.store.variables.disableAudio = true;\ncti.store.variables.disableMessage = true;\n$(\"#send_img .fa-camera\").addClass('selected');"},"_auto_id_":"6aecc28c-968c-4ecc-be22-029bba028a74"},{"type":"otherwise","data":{},"operations":[]},{"event":"click","type":"set-variable","data":{"name":"imageShow","value":"false"},"_auto_id_":"e99caab4-c080-44b1-a7c8-1a39ff95823c"},{"event":"click","type":"set-variable","data":{"name":"photo_panel_open","value":"false"},"_auto_id_":"ffa6f0ff-b76f-4021-80be-f6d7f289ed39"},{"event":"click","type":"inline-function","data":{"code":"cti.store.variables.disableAudio = false;\ncti.store.variables.disableMessage = false;\n$(\"#send_img .fa-camera\").removeClass('selected');"},"_auto_id_":"d9e068c0-d93a-47cc-9dc8-bd4767f930ad"}],"expressions":{"disabled":"$store.variables.photo_enabled != true || $store.variables.responseRequired == false || $store.variables.disablePhoto == true"},"_auto_id_":"e7d69504-12b2-43be-9a61-28bc80def1b2"},{"name":"send_audio","type":"control","item-type":"button","content":"","theme":"minimal","actions":[{"name":"if_1","type":"if","data":{},"operations":[{"type":"value","content":"{{$store.variables.audioShow}}"},{"type":"operator","content":"=="},{"type":"value","content":"true"}]},{"event":"click","type":"set-variable","data":{"name":"audio_panel_open","value":"false"},"_auto_id_":"7d0f14e8-30c2-44ff-8cf1-1fbe17345146"},{"event":"click","type":"set-variable","data":{"name":"audioShow","value":"false"},"_auto_id_":"9433ddfa-ea4d-44f7-86b9-5cc86acda3db"},{"event":"click","type":"set-variable","data":{"name":"recordingFlag","value":"false"},"_auto_id_":"b0dfd915-f0ca-47e2-9a70-238870835999"},{"event":"click","type":"inline-function","data":{"code":"cti.store.variables.disablePhoto = false;\ncti.store.variables.disableMessage = false;\n$('#send_audio .fa-microphone').removeClass('selected');"},"_auto_id_":"9dd787c2-2c8c-4e97-b47a-3aaab874720e"},{"name":"otherwise_1","type":"otherwise","data":{},"operations":[]},{"name":"set_variable_4","event":"click","type":"set-variable","data":{"name":"audioShow","value":"true"},"_auto_id_":"8ca21094-f8c3-4f99-b273-0ccdc133e5db"},{"event":"click","type":"set-variable","data":{"name":"audio_panel_open","value":"true"},"_auto_id_":"d6132cff-da9c-492d-973e-39df98305252"},{"event":"click","type":"set-variable","data":{"name":"recordingFlag","value":"true"},"_auto_id_":"4662db9f-7ba9-4bdd-9860-41567aa194b1"},{"event":"click","type":"inline-function","data":{"code":"cti.store.variables.disablePhoto = true;\ncti.store.variables.disableMessage = true;\n$(\"#send_audio .fa-microphone\").addClass('selected');"},"_auto_id_":"f37393d2-4540-46d0-a9c9-0acc6d72a483"},{"name":"end_if_1","type":"end-if","data":{},"operations":[]}],"expressions":{"disabled":"$store.variables.audio_enabled != true || $store.variables.responseRequired == false || $store.variables.disableAudio == true"},"left-icon":"fa-microphone","classes":"progress-button","_auto_id_":"71d9dba9-05f1-4a97-a393-6bf6a0a91aaf"},{"name":"send_msg","type":"control","item-type":"button","content":"","theme":"minimal","right-icon":"fa-envelope","actions":[{"type":"if","data":{},"_auto_id_":"0da1fbec-af08-4927-9cf4-def5990ab499","operations":[{"type":"value","content":"{{$store.variables.messageShow}}"},{"type":"operator","content":"=="},{"type":"value","content":"true"}]},{"name":"set_variable_4","event":"click","type":"set-variable","data":{"name":"messageShow","value":"false"},"_auto_id_":"0f080521-898c-4fe1-a2f6-fc22dc07ad90"},{"event":"click","type":"set-variable","data":{"name":"msg_panel_open","value":"false"},"_auto_id_":"2070fdff-f56e-4860-995f-c66af2493355"},{"event":"click","type":"inline-function","data":{"code":"cti.store.variables.disablePhoto = false;\ncti.store.variables.disableAudio = false;\n$(\"#send_msg .fa-envelope\").removeClass('selected');"},"_auto_id_":"98467abd-470c-4010-be0a-b82ac1cebe50"},{"type":"otherwise","data":{},"_auto_id_":"339cef6a-b846-4784-aca3-48aee301959c"},{"event":"click","type":"set-variable","data":{"name":"messageShow","value":"true"},"_auto_id_":"724b9076-1ec4-4afc-b376-e16c87b687e2"},{"event":"click","type":"set-variable","data":{"name":"msg_panel_open","value":"true"},"_auto_id_":"0eab6506-5968-4a7d-9cbd-0f4e5f074eee"},{"event":"click","type":"inline-function","data":{"code":"cti.store.variables.disablePhoto = true;\ncti.store.variables.disableAudio = true;\n$(\"#send_msg .fa-envelope\").addClass('selected');"},"_auto_id_":"3aca969b-375b-4b8c-b461-4672d20ce1ed"}],"expressions":{"disabled":"$store.variables.message_enabled != true || $store.variables.responseRequired == false || $store.variables.disableMessage == true"},"_auto_id_":"f6ce49b7-7c63-4314-b52d-6a37c80e2b9b"},{"name":"html_1","type":"content","item-type":"html","content":"<div id=\"chatButtonsText\">\n  <span>Photo</span>\n  <span>Record</span>\n  <span>Message</span>\n</div>","expressions":{},"_auto_id_":"95286e0f-8f1a-4475-a2a3-92ca4f3e00e3"}],"expressions":{},"_auto_id_":"e60bd715-3373-4ca0-a9c5-0f6a0b2e034c"},{"name":"photo_form","type":"area","item-type":"static","content":[{"name":"take_photo","type":"control","item-type":"button","content":"Take Photo","theme":"minimal","left-icon":"fa-camera","expressions":{},"actions":[{"event":"click","type":"take-photo","data":{"quality":100,"multiple":false,"model":"media.take_photo.images"},"_auto_id_":"291cbbd6-a5eb-4e02-855d-2b660db64fbe"}],"_auto_id_":"dff4177b-4ec7-4128-846f-e7e8d01c1805"},{"name":"view_photo","type":"control","item-type":"button","content":"View Photo","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":"Photo_View","_auto_id_":"87e840da-3dfc-4cbb-821e-28129c4e39e9"}],"left-icon":"fa-photo","_auto_id_":"06385476-9da5-4c37-8223-b9190402319d"},{"name":"send_photo","type":"control","item-type":"button","content":"Send","theme":"minimal","expressions":{"disabled":"$store.media.take_photo.images == undefined || $store.media.take_photo.images.length == 0 ||$store.variables.disableSend == true"},"actions":[{"event":"click","type":"set-variable","data":{"name":"disableSend","value":"true"},"_auto_id_":"22f70bde-9a60-43ad-8523-c4d7c4d36712"},{"event":"click","type":"send-xmpp-message","data":{"name":"southeastern","to":"{{$store.variables.currentContact}}","file-path":"{{$store.media.take_photo.images[0]}}","metadata":{"thread_id":"{{$store.variables.currentThreadId}}","thread_type":"child","route":"{{$store.variables.currentRosterGroup}}","reply_type":"photo"},"ttl":"1200"},"_auto_id_":"38d167ae-dc56-45ef-9640-18f7e65d4c34"},{"event":"click","type":"inline-function","data":{"sync":false,"code":"//Send Messsages\nvar msgHistory = cti.store.xmpp.southeastern.history[cti.store.variables.currentContact].messages;\ncti.updateChatHistory(msgHistory[msgHistory.length - 1], 'send');\n//Update ThreadMessages\ncti.updateThreadMessages();\n\ncti.store.variables.imageShow = false;\ncti.store.variables.photo_panel_open = false;\n\n//Remove Audio\nif (cti.store.media.take_photo){\n\tcti.store.media.take_photo.images = [];\n}\n\ncti.store.variables.disableAudio = false;\ncti.store.variables.disableMessage = false;\ncti.store.variables.disableSend = false;\n$(\"#send_img .fa-camera\").removeClass('selected');"},"_auto_id_":"df7a3454-f78a-4b97-8c8c-e19c9a3f53c8","actions":[]}],"_auto_id_":"dfe502b2-017f-45c3-aad6-a0f110b75a04"}],"expressions":{"show":"$store.variables.imageShow == true"},"_auto_id_":"c66d055f-8b80-4386-a702-fd004d4bdc2f"},{"name":"audio_form","type":"area","item-type":"static","content":[{"name":"audio_progress_con","type":"area","item-type":"static","content":[{"name":"progress_bar","type":"content","item-type":"html","content":"<style>\n  .audio-progress{\n    background-color:#00b1ef;\n    height:5px;\n    width: 0vw;\n    border-radius:0 0 2px 2px;\n    display:flex;\n\n    -webkit-transition: width 0.5s, height 0.5s;\n    -moz-transition: width 0.5s, height 0.5s;\n    transition: width 0.5s, height 0.5s;\n}\n\n\n.audio-progress .background-horizontal{\n    height:100%;\n    border-radius:2px;\n}\n</style>\n\n<span id=\"progress-bar\" class=\"audio-progress\"></span>","expressions":{},"_auto_id_":"18e6d9b7-a296-4b89-b134-116fb504faa6"}],"expressions":{},"_auto_id_":"2888c2ba-3300-43a5-9970-8be86053c074"},{"name":"audio_buttons_con","type":"area","item-type":"static","content":[{"name":"audio_switch","type":"control","item-type":"button","content":"Start Recording","theme":"minimal","actions":[{"type":"if","data":{},"_auto_id_":"b635ed25-a2fb-47ce-9910-5495ef1251b0","operations":[{"type":"value","content":"{{$store.variables.recordingFlag}}"},{"type":"operator","content":"=="},{"type":"value","content":"true"}]},{"event":"click","type":"set-variable","data":{"name":"recordingFlag","value":"false"},"_auto_id_":"2d8612ff-77c4-48d3-92f8-19572147657f"},{"event":"click","type":"record-audio","data":{},"_auto_id_":"bb972f7d-65d2-4e76-a0bd-8fd7c538c4bc"},{"event":"click","type":"inline-function","data":{"code":"$('a#audio_switch').text('Stop Recording');\n\n//Progress Bar Functionality\n\n// Set a transition declaration for the duration of the meter.\n// CSS will do the job of animating the progress bar for us.\nvar seconds = 20;\nvar percentage = 100;\n\n$('#progress-bar').css('transition', seconds+'s linear');\n$('#progress-bar').width(percentage+'vw');\n\n//Stop the recording once it reaches 20 seconds\n\nwindow.AudioTimer = setTimeout(cti.audioRecordingFunc, seconds*1000);"},"_auto_id_":"60cf66a9-e773-43f0-aae9-f47c2d2fe291"},{"type":"otherwise","data":{},"_auto_id_":"91d9f947-38ec-4c09-be0c-961c25878587"},{"event":"click","type":"set-variable","data":{"name":"recordingFlag","value":"true"},"_auto_id_":"0b33ba37-1148-4ccd-810c-dafacf6fe18b"},{"event":"click","type":"inline-function","data":{"code":"$('a#audio_switch').text('Start Recording');\n\nvar seconds = 0;\nvar percentage = 0;\n\n$('#progress-bar').css('transition', seconds+'s linear');\n$('#progress-bar').width(percentage+'vw');\n\nclearTimeout(window.AudioTimer);"},"_auto_id_":"4892a683-465f-437f-9925-320d1c80b151"},{"event":"click","type":"stop-record-audio","data":{"multiple":false,"model":"media.audio_switch.audio"},"_auto_id_":"fd5c9505-1144-4fb0-821c-8e6e53ca0f57"}],"expressions":{},"left-icon":"fa-microphone","_auto_id_":"3001725b-4b47-4e53-923f-b42c39a02bbd"},{"name":"send_voice","type":"control","item-type":"button","content":"Send","theme":"minimal","expressions":{"disabled":"$store.media.audio_switch.audio[0] == undefined"},"actions":[{"event":"click","type":"set-variable","data":{"name":"disableSend","value":"true"},"_auto_id_":"024b49e0-5979-48e5-b0fd-b866d77bf7c8"},{"event":"click","type":"send-xmpp-message","data":{"name":"southeastern","message":"","to":"{{$store.variables.currentContact}}","file-path":"{{$store.media.audio_switch.audio[0]}}","metadata":{"route":"{{$store.variables.currentRosterGroup}}","thread_type":"child","thread_id":"{{$store.variables.currentThreadId}}","reply_type":"audio"},"ttl":"1200"},"_auto_id_":"f6486fba-1b31-4dc4-8d35-f8bd4ba6ff49"},{"event":"click","type":"inline-function","data":{"sync":false,"code":"//Send Messsages\nvar msgHistory = cti.store.xmpp.southeastern.history[cti.store.variables.currentContact].messages;\ncti.updateChatHistory(msgHistory[msgHistory.length - 1], 'send');\n//Update ThreadMessages\ncti.updateThreadMessages();\n\ncti.store.variables.audioShow = false;\ncti.store.variables.audio_panel_open = false;\n\n//Remove Audio\nif (cti.store.media.audio_switch){\n\tcti.store.media.audio_switch.audio = [];\n}\ncti.store.variables.disablePhoto = false;\ncti.store.variables.disableMessage = false;\ncti.store.variables.disableSend = false;\n$('#send_audio .fa-microphone').removeClass('selected');"},"_auto_id_":"783795f7-935d-4424-9d6b-fe5bd8e98405","actions":[]}],"_auto_id_":"4e24ffa8-97b6-4508-bf24-90322f4ddfb5"}],"expressions":{},"_auto_id_":"e0d662f2-3a0b-4be4-bbc0-e7d66aa38d8c"}],"expressions":{"show":"$store.variables.audioShow == true"},"_auto_id_":"e5df6099-b6dc-4024-8f85-b1ebb1eaa21f"},{"name":"message_form","type":"area","item-type":"static","content":[{"name":"message_input","type":"question","item-type":"text","label":"","required":false,"multiline":false,"expressions":{},"validators":[],"actions":[{"event":"enter","type":"set-variable","data":{"name":"disableSend","value":"true"},"_auto_id_":"be10e8cf-bd38-4a9d-a131-b550fb467d34"},{"event":"enter","type":"send-xmpp-message","data":{"name":"southeastern","to":"{{$store.variables.currentContact}}","message":"{{$store.pages.Chat_Child.message_input}}","metadata":{"thread_id":"{{$store.variables.currentThreadId}}","thread_type":"child","reply_type":"message","route":"{{$store.variables.currentRosterGroup}}"},"ttl":"1200"},"_auto_id_":"8cad815a-1b45-4bc4-8704-34dd1526f255"},{"event":"enter","type":"inline-function","data":{"sync":true,"code":"//Send Messsages\nvar msgHistory = cti.store.xmpp.southeastern.history[cti.store.variables.currentContact].messages;\ncti.updateChatHistory(msgHistory[msgHistory.length - 1], 'send');\n//Update ThreadMessages\ncti.updateThreadMessages();\n\n//set the message input back to default\ncti.store.pages.Chat_Child.message_input = undefined;\ncti.store.variables.messageShow = false;\ncti.store.variables.msg_panel_open = false;\n\n//Reset other variables\ncti.store.variables.disablePhoto = false;\ncti.store.variables.disableAudio = false;\ncti.store.variables.disableSend = false;\n$(\"#send_msg .fa-envelope\").removeClass('selected');"},"_auto_id_":"26acb77a-ece1-452d-8d3e-0e9c6de652aa"}],"debounce":0.5,"_auto_id_":"db3d7839-e70b-404b-a660-d2d13d07d8b6"},{"name":"send_msgData","type":"control","item-type":"button","content":"Send","theme":"minimal","actions":[{"event":"click","type":"set-variable","data":{"name":"disableSend","value":"true"},"_auto_id_":"7244915f-2279-4a3f-bf55-34de24177b59"},{"event":"click","type":"send-xmpp-message","data":{"to":"{{$store.variables.currentContact}}","message":"{{$store.pages.Chat_Child.message_input}}","name":"southeastern","metadata":{"thread_id":"{{$store.variables.currentThreadId}}","thread_type":"child","reply_type":"message","route":"{{$store.variables.currentRosterGroup}}"},"file-path":"","ttl":"1200"},"_auto_id_":"9bda8d91-8cc6-4594-b13c-7d77c54e36b5"},{"event":"click","type":"inline-function","data":{"sync":false,"code":"//Send Messsages\nvar msgHistory = cti.store.xmpp.southeastern.history[cti.store.variables.currentContact].messages;\ncti.updateChatHistory(msgHistory[msgHistory.length - 1], 'send');\n//Update ThreadMessages\ncti.updateThreadMessages();\n\n//set the message input back to default\ncti.store.pages.Chat_Child.message_input = undefined;\ncti.store.variables.messageShow = false;\ncti.store.variables.msg_panel_open = false;\n\n//Reset other variables\ncti.store.variables.disablePhoto = false;\ncti.store.variables.disableAudio = false;\ncti.store.variables.disableSend = false;\n$(\"#send_msg .fa-envelope\").removeClass('selected');"},"_auto_id_":"abbdcbca-811c-4e4c-8c0d-9ec948d78c43"}],"expressions":{"disabled":"$store.pages.Chat_Child.message_input.length == 0 || $store.pages.Chat_Child.message_input.length == undefined"},"_auto_id_":"4c0ff399-f372-48f1-bb65-40348e2fcf15"}],"expressions":{"show":"$store.variables.messageShow == true"},"_auto_id_":"aec7eb67-1b1a-4ba3-9d8f-caf4ef8c0461"}],"expressions":{},"_auto_id_":"cb71ebc5-9ba6-4387-951a-d88aa10fdd53"}]},{"name":"Location","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"event":"onload","type":"set-variable","data":{"name":"loading_spinner","value":"false"},"_auto_id_":"fbf6b1da-351e-49d2-ab88-3240dfba109c"},{"event":"onload","type":"start-timer","data":{"name":"timer_autocomplete"},"_auto_id_":"ad4290b5-0373-42ae-81aa-728799333347"},{"type":"if","data":{},"_auto_id_":"e02592eb-a200-4af9-a78d-2d5428475918","operations":[{"type":"value","content":"{{$store.xmpp.southeastern.groups}}"},{"type":"operator","content":">"},{"type":"value","content":"0"}]},{"event":"onload","type":"set-variable","data":{"name":"selectedStation","value":"{{$store.xmpp.southeastern.groups[0].name}}"},"_auto_id_":"f9babb8f-b349-4212-be98-1c35b4c68949"},{"event":"onload","type":"set-variable","data":{"name":"currentStation","value":"{{$store.xmpp.southeastern.groups[0].name}}"},"_auto_id_":"07c42208-ed12-4d22-8d4e-9de4400766a2"},{"type":"end-if","data":{},"_auto_id_":"5376c140-54cc-4046-8ff8-c3e5c24cf759"},{"event":"onload","type":"inline-function","data":{"sync":false,"code":"if(cti.store.xmpp.southeastern.groups.length > 0){\n  var stationFromServer = cti.store.xmpp.southeastern.groups[0].name;\n  stationFromServer = stationFromServer.replace(/_|-|\\./g, ' ');\n  stationFromServer = toTitleCase(stationFromServer);\n  cti.store.variables.stationServer = stationFromServer;\n}\n\nfunction toTitleCase(str)\n{\n    return str.replace(/\\w\\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\n}"},"_auto_id_":"ea05dea1-748d-4ff8-9bed-bd354963e730","actions":[]}],"_auto_id_":"152d47d9-fe59-4e1e-b33e-2cab28785d45"}],"content":[{"name":"locationContainer","type":"area","item-type":"scrollable","content":[{"name":"upperLoginText","type":"content","item-type":"html","content":"<h1 class=\"mainTitle\">esia</h1>\n<h2 class=\"titleUnderText\">Employee Service Information App<h2>","expressions":{},"_auto_id_":"cdbd93b9-86bf-4f9a-99a5-404b43107ea3"},{"name":"spinner","type":"content","item-type":"html","_auto_id_":"c6f6aa0c-05ff-42d4-b000-93757ef50788","content":"<div class=\"loadingspinner fa-pulse\"></div>","expressions":{"show":"$store.variables.loading_spinner == true"}},{"name":"html_5","type":"content","item-type":"html","content":"<div id=\"searchfield\">\n  <form id=\"locationInput\"><input type=\"text\" name=\"stations\" class=\"biginput\" placeholder=\"Where are you working today?\" id=\"autocomplete\" value=\"\"></form>\n</div>\n<div>\n  <span style=\"font-size:2.3vh; display:flex; color:white; text-align:center; justify-content:center;\">My Previous Location: {{'$store.variables.stationServer' | store}}</span>\n</div>","expressions":{},"_auto_id_":"59b8d614-fbb9-4745-8e11-28f7d000887c"},{"name":"login_btn","type":"control","item-type":"button","content":"Continue","theme":"default","expressions":{"disabled":"$store.variables.loading_spinner == true || $store.variables.selectedStation == undefined"},"actions":[{"type":"if","data":{},"_auto_id_":"b33bc0fd-f902-489f-be26-14c52d9d0619","operations":[{"type":"value","content":"{{$store.xmpp.southeastern.groups.length}}"},{"type":"operator","content":"<"},{"type":"value","content":"1"}]},{"event":"click","type":"set-variable","data":{"name":"loading_spinner","value":"true"},"_auto_id_":"1ff9e216-a2a4-4d90-a177-b236572e36a3"},{"event":"click","type":"call-api","data":{"name":"lser","operation":"srg_caller_add","params":{"Authorization":"{{$store.variables.userInfo}}","group":"{{$store.variables.selectedStation}}","grouphost":"southeasternrailway.co.uk"}},"_auto_id_":"c377fb0a-53f5-4913-8300-df49da2bf55c"},{"event":"click","type":"set-variable","data":{"name":"currentStation","value":"{{$store.variables.selectedStation}}"},"_auto_id_":"47e16d94-ff1d-4691-8bb6-6976085d25be"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"var stationFromServer = cti.store.variables.selectedStation;\nstationFromServer = stationFromServer.replace(/_|-|\\./g, ' ');\nstationFromServer = toTitleCase(stationFromServer);\ncti.store.variables.stationServer = stationFromServer;\n\ncti.utils.callAction(\"go-to-page\",\"Chat\");\n\n$success();\n\nfunction toTitleCase(str)\n{\n    return str.replace(/\\w\\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\n}"},"_auto_id_":"b37fb05a-59a0-48f4-916c-c9e9c6866a5e"},{"type":"otherwise-if","data":{},"_auto_id_":"bb93fe28-d8cc-4b9f-b99a-4f1400d88033","operations":[{"type":"value","content":"{{$store.xmpp.southeastern.groups[0].name}}"},{"type":"operator","content":"!="},{"type":"value","content":"{{$store.variables.selectedStation}}"}]},{"event":"click","type":"set-variable","data":{"name":"loading_spinner","value":"true"},"_auto_id_":"fc2ccab1-e55a-4b86-bba6-8ef612df09b2"},{"event":"click","type":"call-api","data":{"name":"lser","operation":"srg_caller_del","params":{"group":"{{$store.xmpp.southeastern.groups[0].name}}","Authorization":"{{$store.variables.userInfo}}","grouphost":"southeasternrailway.co.uk"},"sync":true},"_auto_id_":"f5dc576e-30dc-4ff9-847a-17c9a4c4b2d1","actions":[]},{"event":"click","type":"call-api","data":{"name":"lser","operation":"srg_caller_add","params":{"Authorization":"{{$store.variables.userInfo}}","grouphost":"southeasternrailway.co.uk","group":"{{$store.variables.selectedStation}}"},"sync":true},"actions":[],"_auto_id_":"6ef52835-c69e-4f31-9548-36005095555d"},{"event":"click","type":"set-variable","data":{"name":"currentStation","value":"{{$store.variables.selectedStation}}"},"_auto_id_":"b37d63e8-8610-4254-b295-b89a54e482b5"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"var stationFromServer = cti.store.xmpp.southeastern.groups[0].name;\nstationFromServer = stationFromServer.replace(/_|-|\\./g, ' ');\nstationFromServer = toTitleCase(stationFromServer);\ncti.store.variables.stationServer = stationFromServer;\n\ncti.utils.callAction(\"go-to-page\",\"Chat\");\n\n$success();\n\nfunction toTitleCase(str)\n{\n    return str.replace(/\\w\\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\n}"},"_auto_id_":"82b5f710-e6db-4c9c-94b2-4d5334ff1759","actions":[]},{"type":"otherwise","data":{},"_auto_id_":"7f9e373d-26d3-4b61-8b6a-d74893551975"},{"event":"click","type":"set-variable","data":{"name":"loading_spinner","value":"true"},"_auto_id_":"532ef671-2704-457b-b9f3-32954f695728"},{"event":"click","type":"go-to-page","data":"Chat","_auto_id_":"db973346-cfe5-46da-94b9-da12f71dd9f3"}],"_auto_id_":"75981a0f-8f2b-4236-8ae0-bc1580200720"},{"name":"logoutLocation_btn","type":"control","item-type":"button","content":"Log Out","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"  var popup = document.getElementById('popLocLogout');\n  popup.togglePopup();"},"_auto_id_":"d5d194b7-62e3-4cd6-8070-005c0ac10510"}],"_auto_id_":"3b5beb05-82c4-4b53-8f21-39f89ed50a27"},{"name":"popupLocExit","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"html_8","type":"content","item-type":"html","_auto_id_":"6b722fbb-330d-4b9d-a247-a28be76e106f","content":"<span class=\"logoutPopText\">Are you sure you wish to log out?</span>"},{"name":"button_2","type":"control","item-type":"button","_auto_id_":"93b512e6-bfc6-4e62-9b26-69548bc9c026","content":"LOG OUT","theme":"default","expressions":{},"classes":"accept","actions":[{"event":"click","type":"xmpp-logout","data":{"name":"southeastern"},"_auto_id_":"37d9e2b1-fe35-4cc0-bbbf-240237f6810d"},{"event":"click","type":"inline-function","data":{"sync":false,"code":"  var popup = document.getElementById('popLocLogout');\n  popup.togglePopup();"},"_auto_id_":"a325b386-8850-4255-ae99-177d73759248"},{"event":"click","type":"go-to-page","data":"Login","_auto_id_":"9b19546a-fa4c-497d-af2e-0f0cf9e2e1f7"}]},{"name":"button_3","type":"control","item-type":"button","_auto_id_":"3eb1f907-660a-48dd-930f-116abf2a5096","content":"CANCEL","theme":"default","expressions":{},"classes":"cancel","actions":[{"event":"click","type":"inline-function","data":{"sync":false,"code":"  var popup = document.getElementById('popLocLogout');\n  popup.togglePopup();"},"_auto_id_":"defc5e7d-59a9-432d-9dcf-187f83ee4e25"}]}],"component":"ct_popup_box","_auto_id_":"bc417d8d-196c-4f69-8c96-78f1422f24af","attributes":{"id":"popLocLogout"},"actions":[],"expressions":{}},{"name":"bottomLoginText","type":"content","item-type":"html","content":"<p class=\"southEastern\">south<span class=\"southEasternBlue\">eastern</span></p>\n<p class=\"notice\">By using this app, you agree to the Terms, Cookie Policy and Privacy Policy</p>","expressions":{},"_auto_id_":"ff7c66b6-4310-4554-a79f-283202a08adb"}],"expressions":{},"_auto_id_":"bcf91160-493d-4375-8ddc-8afacf8b7402"}]},{"name":"Set_Do_Not_Disturb","config":[],"content":[{"name":"title_bar_5","type":"navigation","item-type":"title-bar","content":[{"name":"back_btn","type":"control","item-type":"button","content":"","theme":"default","left-icon":"fa-arrow-circle-left","actions":[{"event":"click","type":"set-model","data":{"location":"$store.pages.Set_Do_Not_Disturb.duration.value"},"_auto_id_":"d2f4c3d9-dd5e-4da0-a657-91ab3443f477"},{"event":"click","type":"set-model","data":{"location":"$store.pages.Set_Do_Not_Disturb.duration.label"},"_auto_id_":"118b719c-9382-4991-ad78-f813b9e6beb3"},{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"Chat","_auto_id_":"5494a49b-8c84-486d-a804-7db93179ff5c"}],"expressions":{"disabled":"variables.loading_spinner == true"},"_auto_id_":"faee1f48-3f82-4a9d-8e0e-edda63833637"},{"name":"title_9","type":"content","item-type":"title","content":"<h1>Do Not Disturb</h1>","_auto_id_":"e57f04a9-d4d4-4e4b-bcef-234281cd957d"}],"extends":{"type":"area","item-type":"row"},"expressions":{},"_auto_id_":"8b7308e7-1823-4a1f-94de-ffdd34348d9d"},{"name":"main_container","type":"area","item-type":"scrollable","content":[{"name":"spinner","type":"content","item-type":"html","content":"<div class=\"loadingspinner fa-pulse\"></div>","expressions":{"show":"$store.variables.loading_spinner == true"},"_auto_id_":"618199e5-2ac0-45ec-8204-ab9f6f1f7ad6"},{"name":"status_bar","type":"content","item-type":"html","content":"<span>Set Timer</span>","expressions":{},"_auto_id_":"b4fe3894-7391-4a76-b4e8-4b6c114ba4ae"},{"name":"duration","type":"question","item-type":"select","label":"Duration: ","required":true,"options":[{"label":"15 Minutes","value":"15"},{"label":"30 Minutes","value":"30"},{"label":"45 Minutes","value":"45"},{"label":"60 Minutes (Max)","value":"60"},{"label":"6 Seconds (Test)","value":".10"}],"description":"Please select duration in minutes. ","message":"This is a required field","left-icon":"fa-clock-o","expressions":{},"actions":[],"validators":[],"_auto_id_":"1d3f521b-be2e-4c6e-81cc-9349de698582"},{"name":"start_btn","type":"control","item-type":"button","content":"Start","theme":"minimal","expressions":{"disabled":"$store.pages.Set_Do_Not_Disturb.duration == undefined || $store.variables.loading_spinner == true"},"actions":[{"event":"click","type":"inline-function","data":{"code":"cti.__timers.do_not_disturb.time = cti.store.pages.Set_Do_Not_Disturb.duration.value * 60000; \n"},"_auto_id_":"c1974af8-b7f5-4574-a3f6-8b75829216c9"},{"event":"click","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"Dont_Disturb","title":"Do Not Disturb Enabled","text":"You Will Not Receive Notifications for {{$store.pages.Set_Do_Not_Disturb.duration.value}} Minutes."},"_auto_id_":"af705cdd-1055-47d0-8b32-a5f6925cbb52"},{"event":"click","type":"start-timer","data":{"name":"do_not_disturb"},"_auto_id_":"ad5baf73-d120-4092-9559-cca59eae7384"},{"event":"click","type":"call-function","data":{"name":"start_timer","params":{"duration":"{{Set_Do_Not_Disturb.duration.value}}","display":"timer","duration_mins":"{{$store.pages.Set_Do_Not_Disturb.duration.value}}","duration_seconds":""}},"_auto_id_":"cf8e65ce-bb83-41b7-a5f0-06e8b466789d"},{"name":"xmpp_set_status_1","event":"click","type":"xmpp-set-status","data":{"name":"southeastern","status":"dnd"},"_auto_id_":"e86609e0-745e-421f-ab96-b23524ba2781"},{"event":"click","type":"set-model","data":{"location":"$store.variables.start_flag","value":"true"},"_auto_id_":"adef99cc-fdae-4187-8f5c-1486a4e863b4"},{"event":"click","type":"go-to-page","data":"activ_do_not_disturb","_auto_id_":"38fe6621-8e80-44b0-8172-160bf0f00395"}],"_auto_id_":"30eed701-9bb6-4839-b3ba-e739a17f31bb"},{"name":"ct_popup_box_1","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"html_11","type":"content","item-type":"html","_auto_id_":"8aea63c0-29d8-4c7d-bfb9-5aaca68f45c2","content":"<span class=\"logoutPopText\">Are you sure you wish to log out?</span>\n"},{"name":"button_6","type":"control","item-type":"button","_auto_id_":"1d1c7ee9-b442-4c46-9a3a-de991910b824","content":"LOG OUT","theme":"default","expressions":{},"classes":"accept","actions":[{"event":"click","type":"set-variable","data":{"name":"loading_spinner","value":"true"},"_auto_id_":"da37d9e8-3996-43b7-beb1-690d55bf674d"},{"event":"click","type":"stop-timer","data":{"name":"checkExpireMessages"},"_auto_id_":"988afbe3-cf3c-4b08-a1e9-5a2e9bc6b8d2"},{"event":"click","type":"xmpp-logout","data":{"name":"southeastern"},"_auto_id_":"c674dff2-bee9-4a12-8bea-652d38977394"},{"event":"click","type":"inline-function","data":{"sync":false,"code":"  var popup = document.getElementById('popSdndLogout');\n  popup.togglePopup();"},"_auto_id_":"febfaece-c47f-4508-9e87-7bae1bcc70c2"},{"event":"click","type":"go-to-page","data":"Login","_auto_id_":"f3035e82-d5f0-4ac2-85cb-127d96451b87"}]},{"name":"button_7","type":"control","item-type":"button","_auto_id_":"516a1efb-0f20-4f17-ab0a-b494fa0df7c5","content":"CANCEL","theme":"default","expressions":{},"classes":"cancel","actions":[{"event":"click","type":"inline-function","data":{"sync":false,"code":"  var popup = document.getElementById('popSdndLogout');\n  popup.togglePopup();"},"_auto_id_":"b6cf0bc1-a800-4e22-babe-3ec2e2d6bae2"}]}],"component":"ct_popup_box","_auto_id_":"9450feb5-eb20-4dad-9500-6af4929f9947","attributes":{"id":"popSdndLogout"},"actions":[]},{"name":"bottom_container","type":"area","item-type":"row","content":[{"name":"html_7","type":"content","item-type":"html","content":"<span class=\"dndMain\">When 'Do Not Disturb' mode is active, you will not receive notifications</span><span class=\"dndSub\"><strong>Notice: </strong>  Please log out of the app if you wish to take a break longer than one hour, or end your shift.</span>","expressions":{},"_auto_id_":"41043979-6afe-4192-9dcf-4b38a5256cf6"},{"name":"logout_s_btn","type":"control","item-type":"button","content":"Log Out","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"  var popup = document.getElementById('popSdndLogout');\n  popup.togglePopup();"},"_auto_id_":"7aabe8ca-ad3d-4218-bf03-89612b31e152"}],"_auto_id_":"6d093a57-a237-46e4-8d76-c10a2617115a"}],"expressions":{},"_auto_id_":"f95f469a-1d16-404f-a8f6-577160606e63"}],"expressions":{},"_auto_id_":"948b543f-23f2-41b9-95af-53e4cb2f99e9"}]},{"name":"activ_do_not_disturb","config":[],"content":[{"name":"title_bar_5","type":"navigation","item-type":"title-bar","content":[{"name":"title_9","type":"content","item-type":"title","content":"<h1>Do Not Disturb</h1>","_auto_id_":"a7b73e66-11a9-4425-91f6-66f806bbcd0d"}],"extends":{"type":"area","item-type":"row"},"expressions":{},"_auto_id_":"1c145ea0-4691-4d17-a82e-758a4a624b47"},{"name":"main_container","type":"area","item-type":"scrollable","content":[{"name":"spinner","type":"content","item-type":"html","content":"<div class=\"loadingspinner fa-pulse\"></div>","expressions":{"show":"$store.variables.loading_spinner == true"},"_auto_id_":"a9c2ef65-9a5d-4b22-93ff-0b36af897723"},{"name":"status_bar","type":"content","item-type":"html","content":"<span>Do Not Disturb Active</span>","expressions":{},"_auto_id_":"eae5b6f8-e8e2-46b8-8331-e90306436c3f"},{"name":"html_12","type":"content","item-type":"html","content":"<span id=\"timer\">00:00 Seconds</span>","_auto_id_":"3acc70ef-b843-4513-9231-886d3b25208b","expressions":{}},{"name":"resume","type":"control","item-type":"button","content":"Resume","theme":"default","expressions":{"disabled":"variables.loading_spinner == true"},"actions":[{"event":"click","type":"stop-timer","data":{"name":"do_not_disturb"},"_auto_id_":"c6335cf8-93df-4282-8a72-724742fa0165"},{"event":"click","type":"inline-function","data":{"code":"clearInterval(cti.store.variables.DND_clock);"},"_auto_id_":"383ecdf0-f7c7-4ee0-aed1-6cc9a4a090da","actions":[]},{"event":"click","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"dont_disturb_off","title":"Do Not Disturb Disabled","text":"You Will Now Receive Notifications."},"_auto_id_":"b4e37892-6716-44bf-966e-17fc4aec7c36"},{"name":"xmpp_set_status_1","event":"click","type":"xmpp-set-status","data":{"name":"southeastern","status":"chat"},"_auto_id_":"b70d76bb-c78e-4cd9-8d04-d4bef315bef5"},{"event":"click","type":"set-model","data":{"location":"$store.variables.start_flag","value":"false"},"_auto_id_":"b22f8f3e-d781-4830-8ff5-276a4e30b44a"},{"event":"click","type":"go-to-page","data":"Chat","_auto_id_":"ef7bda5d-be31-481d-a44d-aa56c302708f"}],"_auto_id_":"2e42035b-4c7f-4e1f-aaaa-4d604d741bb8"},{"name":"ct_popup_box_2","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"html_12","type":"content","item-type":"html","_auto_id_":"5c229a22-3bc8-4fbb-93ae-1daa70b183a8","content":"<span class=\"logoutPopText\">Are you sure you wish to log out?</span>"},{"name":"button_9","type":"control","item-type":"button","_auto_id_":"d4ac335c-5d63-4c1f-835b-6d680d2f1406","content":"LOG OUT","theme":"default","expressions":{},"classes":"accept","actions":[{"event":"click","type":"set-variable","data":{"name":"loading_spinner","value":"true"},"_auto_id_":"da37d9e8-3996-43b7-beb1-690d55bf674d"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"clearInterval(cti.store.variables.DND_clock);"},"_auto_id_":"845c8ef5-b0a0-4581-80be-36481ff10615"},{"event":"click","type":"stop-timer","data":{"name":"checkExpireMessages"},"_auto_id_":"988afbe3-cf3c-4b08-a1e9-5a2e9bc6b8d2"},{"event":"click","type":"xmpp-logout","data":{"name":"southeastern"},"_auto_id_":"c674dff2-bee9-4a12-8bea-652d38977394"},{"event":"click","type":"inline-function","data":{"sync":false,"code":"  var popup = document.getElementById('popAdndLogout');\n  popup.togglePopup();"},"_auto_id_":"febfaece-c47f-4508-9e87-7bae1bcc70c2"},{"event":"click","type":"go-to-page","data":"Login","_auto_id_":"f3035e82-d5f0-4ac2-85cb-127d96451b87"}]},{"name":"button_8","type":"control","item-type":"button","_auto_id_":"e9e6f216-1678-4a30-8133-299b2d05215e","content":"CANCEL","theme":"default","expressions":{},"classes":"cancel","actions":[{"event":"click","type":"inline-function","data":{"sync":false,"code":"  var popup = document.getElementById('popAdndLogout');\n  popup.togglePopup();"},"_auto_id_":"c60fa32d-81ad-4aff-b6a9-98e13ca300c7"}]}],"component":"ct_popup_box","_auto_id_":"c1e7ba1a-07ad-42d6-a7e9-674e610a6c07","attributes":{"id":"popAdndLogout"}},{"name":"bottom_container","type":"area","item-type":"static","content":[{"name":"html_7","type":"content","item-type":"html","content":"<span class=\"dndMain\">'Do Not Disturb' mode is active, you will not receive notifications</span><span class=\"dndSub\"><strong>Notice: </strong>  Please log out of the app if you wish to take a break longer than one hour, or end your shift.</span>","expressions":{},"_auto_id_":"e39fb58a-9ddf-4041-9a60-28fdfae2489c"},{"name":"logout_s_btn","type":"control","item-type":"button","content":"Log Out","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"code":"  var popup = document.getElementById('popAdndLogout');\n  popup.togglePopup();"},"_auto_id_":"380938ff-b93a-46a2-abb8-60f689714c91"}],"_auto_id_":"14aead72-90d8-4133-a514-4e4492dc7d41"}],"expressions":{},"_auto_id_":"0bd1be38-8c5b-4d3a-aeb8-6524c73e7ac6"}],"expressions":{},"_auto_id_":"f3477176-2419-4673-8ea2-0755c02d282d"}],"start":false},{"name":"Photo_View","config":[],"content":[{"name":"title_bar_7","type":"navigation","item-type":"title-bar","content":[{"name":"back_btn","type":"control","item-type":"button","content":"","theme":"default","expressions":{},"left-icon":"fa-arrow-circle-left","actions":[{"event":"click","type":"go-to-page","data":"Chat_Child","_auto_id_":"30843473-1afd-4810-9d06-eede5f17e2d4"}],"_auto_id_":"44c545e5-baa8-4b6a-ba5d-89b3afafccdc"},{"name":"title_11","type":"content","item-type":"title","content":"<h1>View Taken Photo</h1>","_auto_id_":"4bc044a7-8216-49c9-8ef0-3fa17103646b"}],"extends":{"type":"area","item-type":"row"},"_auto_id_":"56d70cc4-6a19-4b23-9b13-3b809a96065d","expressions":{}},{"name":"scrollable_9","type":"area","item-type":"scrollable","content":[{"name":"image_2","type":"media","item-type":"image","actions":[],"expressions":{},"model":"$store.media.take_photo.images","_auto_id_":"d9c138d1-d95e-4ec6-a4a9-88ca887988d7"}],"_auto_id_":"3c3637e2-4341-46d5-b769-3a7e9ba4ff43"}]},{"name":"Msg_View","config":[],"content":[{"name":"title_bar_6","type":"navigation","item-type":"title-bar","content":[{"name":"back_btn","type":"control","item-type":"button","content":"","theme":"default","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":"Chat_Child","_auto_id_":"2f0d1431-8dde-4c89-85c0-2b679090e857"}],"left-icon":"fa-arrow-circle-left","_auto_id_":"6fd6f7da-0c70-497e-909d-c9551237ad3c"},{"name":"title_6","type":"content","item-type":"title","content":"<h1>View Message Image</h1>","_auto_id_":"0aa9c294-6aef-4c2f-addc-bb910792c946"}],"extends":{"type":"area","item-type":"row"},"expressions":{},"_auto_id_":"6cae6eee-390f-4180-a3bc-2ccd71e2efcf"},{"name":"scrollable_8","type":"area","item-type":"scrollable","content":[{"name":"image_3","type":"media","item-type":"image","model":"$store.variables.currentImage","actions":[],"expressions":{},"_auto_id_":"09c549cb-c2fd-454f-a6ac-e2522725757f"}],"_auto_id_":"954ad437-3937-482a-84eb-62333aa94a8b"}]}],"config":[{"name":"disableSend","type":"script","item-type":"variable","_auto_id_":"d3fb908e-0868-454e-b291-af8e5034fd28","variable-type":"boolean","value":"false"},{"name":"timer_autocomplete","type":"script","item-type":"timer","timer-type":"delay","time":"2","actions":[{"event":"click","type":"call-function","data":{"name":"autocomplete"},"_auto_id_":"3d4dd736-a74c-450d-bea1-efb4595b71e9"}],"_auto_id_":"3d61fe8a-e01b-4f6c-bd09-8a50941b42b3"},{"name":"checkExpireMessages","type":"script","item-type":"timer","timer-type":"interval","time":"60000","actions":[{"event":"click","type":"call-function","data":{"name":"removeExpireMessages"},"_auto_id_":"5c3f9e2c-b6e9-44d8-b34c-8fa66dbd85cb"}],"_auto_id_":"ab36cae7-4b43-40b8-8561-71bb3b4c186d"},{"name":"do_not_disturb","type":"script","item-type":"timer","timer-type":"delay","time":"60000","actions":[{"event":"click","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"dont_disturb_off","title":"Do Not Disturb Disabled","text":"You will now receive notifications."},"_auto_id_":"b5dfc6ab-0f4c-420e-bcf2-bc4db4f3e8be"},{"event":"click","type":"xmpp-set-status","data":{"name":"southeastern","status":"chat"},"_auto_id_":"f25a5eff-4dd0-4e03-a39f-f6c2af85000f"},{"event":"click","type":"stop-timer","data":{"name":"do_not_disturb"},"_auto_id_":"1ed6c7e7-8122-4c92-8c7a-09b43bff6de3"},{"event":"click","type":"go-to-page","data":"Chat","_auto_id_":"854db271-aafc-4dcb-830c-b9fc07064130"}],"_auto_id_":"3d5f3c76-d535-4de7-a8f7-cf74a1f47831"},{"name":"debugMode","type":"script","item-type":"variable","variable-type":"boolean","value":"true","_auto_id_":"ebd2ddc0-b0f8-40eb-9f80-ad2729405fab"},{"name":"css_asset_1","type":"style","item-type":"css-asset","_auto_id_":"84e08ee1-6d4b-49c5-864b-d01ded0c2de9","fileName":"stylesLSERConsumer.css"},{"name":"font_asset_1","type":"style","item-type":"font-asset","fileName":"Digit.ttf","_auto_id_":"e88f8c0a-b5e7-4aef-b4a2-d438d9e9f270"},{"name":"js_asset_1","type":"script","item-type":"js-asset","fileName":"jquery.autocomplete.min.js","_auto_id_":"c398480a-a31e-4711-ad9e-05e545574c95"},{"name":"js_asset_2","type":"script","item-type":"js-asset","fileName":"Moment.js","_auto_id_":"420e3f28-f01c-4fbe-92e2-b3ffc544f32b"},{"name":"lser","type":"integration","item-type":"api","headers":{},"params":[],"operations":[{"name":"srg_caller_add","method":"POST","path":"/srg_caller_add","summary":"srg_caller_add","params":[{"name":"Authorization","type":"string","description":"Authorization","in":"header","required":true,"default":"Basic YmVuQHNvdXRoZWFzdGVybnJhaWx3YXkuY28udWs6YmVu"},{"name":"group","type":"string","description":"json object","in":"body","required":true},{"name":"grouphost","type":"string","description":"json object","in":"body","required":true}],"responses":[{"type":"200","description":"ok"}]},{"name":"srg_caller_del","method":"POST","path":"/srg_caller_del","summary":"srg_caller_del","params":[{"name":"Authorization","type":"string","description":"Authorization","in":"header","required":true,"default":"Basic YmVuQHNvdXRoZWFzdGVybnJhaWx3YXkuY28udWs6YmVu"},{"name":"group","type":"string","description":"json object","in":"body","required":true},{"name":"grouphost","type":"string","description":"json object","in":"body","required":true}],"responses":[{"type":"200","description":"ok"}]}],"url":"http://lser-docker-dev.cloudapp.net:5280/api","definitions":{"srg_caller_add_del":{"type":"object","description":"Add or delete","required":["group","grouphost"],"properties":{"group":{"type":"string","default":"st_pancras"},"grouphost":{"type":"string","default":"southeasternrailway.co.uk"}}}},"_auto_id_":"51b0b342-8168-47bb-a301-7e6857cb150d"},{"name":"updateChatHistory","type":"script","item-type":"function","sync":false,"params":[{"name":"message"},{"name":"type"}],"content":"//debugger;\n//LSER messages management\n\nvar expiredMins = 10;\n\n// This is your chat history store where your lists are working from \nif(cti.store.userChats !== undefined) {\n\tvar userChats = cti.store.userChats;\n}\nelse {\n\tvar userChats = [];\n}\n\n// Default is non parent message\nvar isParent = false;\nvar isMedia = false;\n\n// Grab some friendly formatted timestamps\n// Do this here because it's used throughout\n// all paths in the conditions below\nvar date = new moment(message.ts).format('DD/MM/YY');\nvar time = new moment(message.ts).format('HH:mm');\n\n// Inspect message\nif(message.metadata.thread_type === 'parent') {\n\tisParent = true;\n}\n\n// Convert the strings that we need back into objects \nif (typeof message.metadata.route === \"string\"){\n\tmessage.metadata.route = message.metadata.route .split(',');\n}\nif (typeof message.metadata.response_type === \"string\"){\n\tmessage.metadata.response_type = message.metadata.response_type .split(',');\n}\nif (typeof message.metadata.station === \"string\"){\n\tmessage.metadata.station = message.metadata.station .split(',');\n}\n\nvar currentChatsMatchingFrom = jQuery.grep(userChats, function(e, idx) {\n\treturn e.thread_id === message.metadata.thread_id;\n});\n\nif(!isParent){\n\t// We have found an existing chat from this user\n\t// So we add this message to the history of this chat\n\tif(currentChatsMatchingFrom.length > 0) {\n\t\tupdateHistory(currentChatsMatchingFrom, message, date, time);\n\t}\n}\nelse {\n\tif(currentChatsMatchingFrom.length > 0) {\n\t\tupdateThread(currentChatsMatchingFrom, message, date, time);\n\t}\n\t// This is a new message from this user, so w\n\t// have to create a new chat instance \n\telse {\n\t\tcreateNewThread(message, date, time);\n\t}\n}\n\n// Finally, we save our chat history back to storage\ncti.store.userChats = userChats;\n\nfunction updateThread(currentChat, message, date,time){\n\tvar currentChat = currentChat[0];\n\n\tcurrentChat.title = message.metadata.title,\n\tcurrentChat.tagline = message.metadata.tagline,\n\tcurrentChat.priority = message.metadata.priority,\n\tcurrentChat.body = message.body,\n\tcurrentChat.route = message.metadata.route,\n\tcurrentChat.response_required = message.metadata.response_required,\n\tcurrentChat.response_type = message.metadata.response_type,\n\tcurrentChat.station = message.metadata.station,\n\tcurrentChat.expired = message.metadata.expired,\n\t\n\tcurrentChat.last_update = {\n\t\tcontent: message.body,\n\t\tdate: date,\n\t\ttime: time\n\t};\n\t\n\tif(message.metadata.expired == 'true'){\n\t\tcurrentChat.expired_time = new moment().add(expiredMins, 'minutes').format('HH:mm');\n\t}\n\telse {\n\t\tcurrentChat.expired_time = '';\n\t}\n\t\n\tcti.store.variables.audio_enabled = false;\n\tcti.store.variables.photo_enabled = false; \n\tcti.store.variables.message_enabled = false;\n\t\n\tif(cti.store.state.currentPage = \"Chat_Child\"){\n\t\tif(messages.metadata.response_required === 'yes'){\n\t\t  for (i=0; i < message.metadata.response_type.length; i++){\n\t\t\tswitch(message.metadata.response_type[i]){\n\t\t\t  case \"audio\": cti.store.variables.audio_enabled = true; \n\t\t\t  break;\n\t\t\t  case \"photo\": cti.store.variables.photo_enabled = true; \n\t\t\t  break;\n\t\t\t  case \"message\": cti.store.variables.message_enabled = true; \n\t\t\t  default: break;\n\t\t\t}\n\t\t  }\n\t\t}\n\t}\n}\n\nfunction updateHistory(currentChat, message, date, time){\n\tvar currentChat = currentChat[0];\n\t\n\tcurrentChat.last_reply = {\n\tcontent: message.body,\n\t\tdate: date,\n\t\ttime: time\n\t};\n\t\n\tmessage.metadata.expired_time = new moment().add(expiredMins, 'minutes').format('HH:mm');\n\tcurrentChat.history.push(message);\n}\n\nfunction createNewThread(message, date, time){\n\t\n\tvar chat = \n\t{\n\t\t\"from\": message.from,\n\t\t\"id\": message.id,\n\t\t\"thread_id\": message.metadata.thread_id,\n\t\t\"title\": message.metadata.title,\n\t\t\"tagline\": message.metadata.tagline,\n\t\t\"priority\": message.metadata.priority,\n\t\t\"body\": message.body,\n\t\t\"route\": message.metadata.route,\n\t\t\"station\": message.metadata.station,\n\t\t\"expired\": message.metadata.expired,\n\t\t\"expired_time\": \"\",\n\t\t\"response_required\": message.metadata.response_required,\n\t\t\"response_type\": message.metadata.response_type,\n\t\t\"confirm_message\": message.metadata.confirm_message,\n\t\t\"media\": {\n\t\t\t\"local\": message.media.local,\n\t\t\t\"remote\": message.media.remote,\n\t\t\t\"type\": message.media.type,\n\t\t\t\"status\": message.media.status,\n\t\t},\n\t\t\"status\": message.status,\n\t\t\"history\": [],\n\t\t\"original\": [message],\n\t\t\"last_update\": {\n\t\t\t\"content\": message.body,\n\t\t\t\"date\": date,\n\t\t\t\"time\": time,\n\t\t},\n\t\t\"last_reply\": {\n\t\t\t\"content\": message.body,\n\t\t\t\"date\": date,\n\t\t\t\"time\": time,\n\t\t}\n\t}\n\t\n\tuserChats.push(chat);\n}","_auto_id_":"5447d123-007e-4c94-af77-a88f5b291259"},{"name":"updateThreadMessages","type":"script","item-type":"function","sync":false,"params":[],"content":"var currentPage = cti.store.state.currentPage;\n\nif (currentPage === \"Chat_Child\") {\n\tconsole.log(\"Thread Update\");\n\n\tvar userChats = cti.store.userChats;\n\tvar threadId = cti.store.variables.currentThreadId;\n\n\tvar currentChatsMatchingFrom = jQuery.grep(userChats, function(e, idx) {\n\t\treturn e.thread_id === threadId;\n\t});\n\n\tvar messageParent = currentChatsMatchingFrom;\n\tvar messageChildren = currentChatsMatchingFrom[0].history;\n\t\n\tcti.store.variables.messageParent = messageParent;\n\tcti.store.variables.messageChildren = messageChildren;\n\tcti.utils.updatePage();\n}\nelse {\n\treturn false;\n}","_auto_id_":"1c27fb08-fdab-449f-9841-cb04305adb16"},{"name":"removeExpireMessages","type":"script","item-type":"function","sync":false,"params":[],"content":"if(cti.store.userChats !== undefined) {\n\tvar userChats = cti.store.userChats;\n}\nelse {\n\treturn;\n}\n\nvar currentDate = new moment().format('DD/MM/YY');\nvar currentTime = new moment().format('HH:mm');\n\n//Removing messages that are Closed in the Main Thread\nfor (var i in userChats){\n\tif(userChats[i].expired_time != \"\"){\n\t\tif(currentDate > userChats[i].last_update.date || currentTime > userChats[i].expired_time){\n\t\t\tconsole.log(\"EXPIRED MESSAGE: \" + userChats[i].thread_id);\n\t\t\tuserChats.splice(i, 1);\n\t\t}\n\t}\n}\n\n//Removing messages that are expired in a thread history\nfor (var i in userChats){\n\tfor (var j in userChats[i].history){\n\t\tif(currentDate > userChats[i].last_reply.date || currentTime > userChats[i].history[j].metadata.expired_time){\n\t\t\tconsole.log(\"EXPIRED CHILD MESSAGE: \"+ userChats[i].history[j].body);\n\t\t\tuserChats[i].history.splice(j, 1);\n\t\t}\n\t}\n}\n\ncti.utils.updatePage();\n//Run if you're in the thread messages to update the UI\ncti.updateThreadMessages();","_auto_id_":"dfdb76ac-40f8-4618-865b-9544cfe9b73d"},{"name":"audioRecordingFunc","type":"script","item-type":"function","params":[],"content":"    cti.utils.callAction(\"stop-record-audio\", \n    {\n      \"model\": \"media.audio_switch.audio\",\n      \"multiple\": false\n    });\n    cti.store.variables.recordingFlag = true;\n    $('a#audio_switch').text('Start Recording');\n    var seconds = 0;\n    var percentage = 0;\n    $('#progress-bar').css('transition', seconds+'s linear');\n    $('#progress-bar').width(percentage+'vw');\n\tconsole.log(\"stop-recording\");","_auto_id_":"90c322c4-74e1-46b8-9597-48685d6e38f3"},{"name":"start_timer","type":"script","item-type":"function","params":[{"name":"duration_mins","description":"Duration measured in minutes.","required":false},{"name":"display","description":"where to display the countdown timer.","required":true},{"name":"duration_seconds","description":"The countdown timer duration in seconds.","required":false}],"content":"//debugger; \nvar start = Date.now(),\n        diff,\n        minutes,\n        seconds;\n\ntimer_display = document.querySelector('#' + display);    \nif (duration_mins > 0)\nduration = duration_mins * 60; // value passed is in minutes - need to convert to seconds. \n\n\n\nfunction timer() {\n        // get the number of seconds that have elapsed since \n        // startTimer() was called\n \n        diff = duration - (((Date.now() - start) / 1000) | 0);\n\n        // does the same job as parseInt truncates the float\n        minutes = (diff / 60) | 0;\n        seconds = (diff % 60) | 0;\n\n        minutes = minutes < 10 ? \"0\" + minutes : minutes;\n        seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\t\t\n  \t\n        timer_display.textContent = minutes + \":\" + seconds; \n\n        if (diff <= 0) {\n            // add one second so that the count down starts at the full duration\n            // example 05:00 not 04:59\n            start = Date.now() + 1000;\n            clearInterval(cti.store.variables.DND_clock);\n        }\n    };\n    // we don't want to wait a full second before the timer starts\ntimer();\ncti.store.variables.DND_clock = setInterval(timer, 1000);\n","_auto_id_":"fa7d311c-88a2-4178-9b77-11fa97aefecc"},{"name":"autocomplete","type":"script","item-type":"function","params":[],"content":"jQuery(function(){\n  var stations = [{\n\t\t\"data\": \"abbey_wood\",\n\t\t\"value\": \"Abbey Wood\"\n\t}, {\n\t\t\"data\": \"adisham\",\n\t\t\"value\": \"Adisham\"\n\t}, {\n\t\t\"data\": \"albany_park\",\n\t\t\"value\": \"Albany Park\"\n\t}, {\n\t\t\"data\": \"ashford\",\n\t\t\"value\": \"Ashford\"\n\t}, {\n\t\t\"data\": \"ashford_international\",\n\t\t\"value\": \"Ashford International\"\n\t}, {\n\t\t\"data\": \"aylesford\",\n\t\t\"value\": \"Aylesford\"\n\t}, {\n\t\t\"data\": \"aylesham\",\n\t\t\"value\": \"Aylesham\"\n\t}, {\n\t\t\"data\": \"barming\",\n\t\t\"value\": \"Barming\"\n\t}, {\n\t\t\"data\": \"barnehurst\",\n\t\t\"value\": \"Barnehurst\"\n\t}, {\n\t\t\"data\": \"battle\",\n\t\t\"value\": \"Battle\"\n\t}, {\n\t\t\"data\": \"bearsted\",\n\t\t\"value\": \"Bearsted\"\n\t}, {\n\t\t\"data\": \"beckenham_junction\",\n\t\t\"value\": \"Beckenham Junction\"\n\t}, {\n\t\t\"data\": \"bekesbourne\",\n\t\t\"value\": \"Bekesbourne\"\n\t}, {\n\t\t\"data\": \"beltring\",\n\t\t\"value\": \"Beltring\"\n\t}, {\n\t\t\"data\": \"belvedere\",\n\t\t\"value\": \"Belvedere\"\n\t}, {\n\t\t\"data\": \"bexley\",\n\t\t\"value\": \"Bexley\"\n\t}, {\n\t\t\"data\": \"bexleyheath\",\n\t\t\"value\": \"Bexleyheath\"\n\t}, {\n\t\t\"data\": \"bickley\",\n\t\t\"value\": \"Bickley\"\n\t}, {\n\t\t\"data\": \"birchington_on_sea\",\n\t\t\"value\": \"Birchington On Sea\"\n\t}, {\n\t\t\"data\": \"blackheath\",\n\t\t\"value\": \"Blackheath\"\n\t}, {\n\t\t\"data\": \"borough_green\",\n\t\t\"value\": \"Borough Green\"\n\t}, {\n\t\t\"data\": \"brixton\",\n\t\t\"value\": \"Brixton\"\n\t}, {\n\t\t\"data\": \"broadstairs\",\n\t\t\"value\": \"Broadstairs\"\n\t}, {\n\t\t\"data\": \"bromley_north\",\n\t\t\"value\": \"Bromley North\"\n\t}, {\n\t\t\"data\": \"bromley_south\",\n\t\t\"value\": \"Bromley South\"\n\t}, {\n\t\t\"data\": \"cannon_street\",\n\t\t\"value\": \"Cannon Street\"\n\t}, {\n\t\t\"data\": \"canterbury_east\",\n\t\t\"value\": \"Canterbury East\"\n\t}, {\n\t\t\"data\": \"canterbury_west\",\n\t\t\"value\": \"Cantebury West\"\n\t}, {\n\t\t\"data\": \"catford_bridge\",\n\t\t\"value\": \"Catford Bridge\"\n\t}, {\n\t\t\"data\": \"charing\",\n\t\t\"value\": \"Charing\"\n\t}, {\n\t\t\"data\": \"charing_cross\",\n\t\t\"value\": \"Charing Cross\"\n\t}, {\n\t\t\"data\": \"charlton\",\n\t\t\"value\": \"Charlton\"\n\t}, {\n\t\t\"data\": \"chartham\",\n\t\t\"value\": \"Chartham\"\n\t}, {\n\t\t\"data\": \"chatham\",\n\t\t\"value\": \"Chatham\"\n\t}, {\n\t\t\"data\": \"chelsfield\",\n\t\t\"value\": \"Chelsfield\"\n\t}, {\n\t\t\"data\": \"chelsfield_swalecliffe\",\n\t\t\"value\": \"Chelsfield & Swalecliffe\"\n\t}, {\n\t\t\"data\": \"chilham\",\n\t\t\"value\": \"Chilham\"\n\t}, {\n\t\t\"data\": \"chislehurst\",\n\t\t\"value\": \"Chislehurst\"\n\t}, {\n\t\t\"data\": \"clock_house\",\n\t\t\"value\": \"Clock House\"\n\t}, {\n\t\t\"data\": \"crayford\",\n\t\t\"value\": \"Crayford\"\n\t}, {\n\t\t\"data\": \"crowhurst\",\n\t\t\"value\": \"Crowhurst\"\n\t}, {\n\t\t\"data\": \"cuxton\",\n\t\t\"value\": \"Cuxton\"\n\t}, {\n\t\t\"data\": \"dartford\",\n\t\t\"value\": \"Dartford\"\n\t}, {\n\t\t\"data\": \"deal\",\n\t\t\"value\": \"Deal\"\n\t}, {\n\t\t\"data\": \"deptford\",\n\t\t\"value\": \"Deptford\"\n\t}, {\n\t\t\"data\": \"dover\",\n\t\t\"value\": \"Dover\"\n\t}, {\n\t\t\"data\": \"dumpton_park\",\n\t\t\"value\": \"Dumpton Park\"\n\t}, {\n\t\t\"data\": \"dunton_green\",\n\t\t\"value\": \"Dunton Green\"\n\t}, {\n\t\t\"data\": \"east_farleigh\",\n\t\t\"value\": \"East Farleigh\"\n\t}, {\n\t\t\"data\": \"east_malling\",\n\t\t\"value\": \"East Malling\"\n\t}, {\n\t\t\"data\": \"ebbsfleet\",\n\t\t\"value\": \"Ebbsfleet\"\n\t}, {\n\t\t\"data\": \"eden_park\",\n\t\t\"value\": \"Eden Park\"\n\t}, {\n\t\t\"data\": \"elmers_end\",\n\t\t\"value\": \"Elmers End\"\n\t}, {\n\t\t\"data\": \"elmstead_woods\",\n\t\t\"value\": \"Elmstead Woods\"\n\t}, {\n\t\t\"data\": \"eltham\",\n\t\t\"value\": \"Eltham\"\n\t}, {\n\t\t\"data\": \"erith\",\n\t\t\"value\": \"Erith\"\n\t}, {\n\t\t\"data\": \"etchingham\",\n\t\t\"value\": \"Etchingham\"\n\t}, {\n\t\t\"data\": \"falconwood\",\n\t\t\"value\": \"Falconwood\"\n\t}, {\n\t\t\"data\": \"farningham_road\",\n\t\t\"value\": \"Farningham Road\"\n\t}, {\n\t\t\"data\": \"faversham\",\n\t\t\"value\": \"Faversham\"\n\t}, {\n\t\t\"data\": \"folkestone_central\",\n\t\t\"value\": \"Folkestone Central\"\n\t}, {\n\t\t\"data\": \"folkestone_west\",\n\t\t\"value\": \"Folkestone West\"\n\t}, {\n\t\t\"data\": \"frant\",\n\t\t\"value\": \"Frant\"\n\t}, {\n\t\t\"data\": \"gillingham\",\n\t\t\"value\": \"Gillingham\"\n\t}, {\n\t\t\"data\": \"gravesend\",\n\t\t\"value\": \"Gravesend\"\n\t}, {\n\t\t\"data\": \"greenhithe\",\n\t\t\"value\": \"Greenhithe\"\n\t}, {\n\t\t\"data\": \"greenwich\",\n\t\t\"value\": \"Greenwich\"\n\t}, {\n\t\t\"data\": \"grove_park\",\n\t\t\"value\": \"Grove Park\"\n\t}, {\n\t\t\"data\": \"halling\",\n\t\t\"value\": \"Halling\"\n\t}, {\n\t\t\"data\": \"harrietsham\",\n\t\t\"value\": \"Harrietsham\"\n\t}, {\n\t\t\"data\": \"hastings\",\n\t\t\"value\": \"Hastings\"\n\t}, {\n\t\t\"data\": \"hayes\",\n\t\t\"value\": \"Hayes\"\n\t}, {\n\t\t\"data\": \"headcorn\",\n\t\t\"value\": \"Headcorn\"\n\t}, {\n\t\t\"data\": \"herne_bay\",\n\t\t\"value\": \"Herne Bay\"\n\t}, {\n\t\t\"data\": \"herne_hill\",\n\t\t\"value\": \"Herne Hill\"\n\t}, {\n\t\t\"data\": \"high_brooms\",\n\t\t\"value\": \"High Brooms\"\n\t}, {\n\t\t\"data\": \"higham\",\n\t\t\"value\": \"Higham\"\n\t}, {\n\t\t\"data\": \"hildenborough\",\n\t\t\"value\": \"Hildenborough\"\n\t}, {\n\t\t\"data\": \"hither_green\",\n\t\t\"value\": \"Hither Green\"\n\t}, {\n\t\t\"data\": \"hollingbourne\",\n\t\t\"value\": \"Hollingbourne\"\n\t}, {\n\t\t\"data\": \"kearsney\",\n\t\t\"value\": \"Kearsney\"\n\t}, {\n\t\t\"data\": \"kemsing\",\n\t\t\"value\": \"Kemsing\"\n\t}, {\n\t\t\"data\": \"kemsley\",\n\t\t\"value\": \"Kemsley\"\n\t}, {\n\t\t\"data\": \"kent_house\",\n\t\t\"value\": \"Kent House\"\n\t}, {\n\t\t\"data\": \"kidbrooke\",\n\t\t\"value\": \"Kidbrooke\"\n\t}, {\n\t\t\"data\": \"knockholt\",\n\t\t\"value\": \"Knockholt\"\n\t}, {\n\t\t\"data\": \"ladywell\",\n\t\t\"value\": \"Ladywell\"\n\t}, {\n\t\t\"data\": \"lee\",\n\t\t\"value\": \"Lee\"\n\t}, {\n\t\t\"data\": \"lenham\",\n\t\t\"value\": \"Lenham\"\n\t}, {\n\t\t\"data\": \"lewisham\",\n\t\t\"value\": \"Lewisham\"\n\t}, {\n\t\t\"data\": \"london_bridge\",\n\t\t\"value\": \"London Bridge\"\n\t}, {\n\t\t\"data\": \"london_victoria\",\n\t\t\"value\": \"London Victoria\"\n\t}, {\n\t\t\"data\": \"longfield\",\n\t\t\"value\": \"Longfield\"\n\t}, {\n\t\t\"data\": \"lower_sydenham\",\n\t\t\"value\": \"Lower Sydenham\"\n\t}, {\n\t\t\"data\": \"maidstone_barracks\",\n\t\t\"value\": \"Maidstone Barracks\"\n\t}, {\n\t\t\"data\": \"maidstone_east\",\n\t\t\"value\": \"Maidstone East\"\n\t}, {\n\t\t\"data\": \"maidstone_west\",\n\t\t\"value\": \"Maidstone West\"\n\t}, {\n\t\t\"data\": \"marden\",\n\t\t\"value\": \"Marden\"\n\t}, {\n\t\t\"data\": \"margate\",\n\t\t\"value\": \"Margate\"\n\t}, {\n\t\t\"data\": \"martin_mill\",\n\t\t\"value\": \"Martin Mill\"\n\t}, {\n\t\t\"data\": \"maze_hill\",\n\t\t\"value\": \"Maze Hill\"\n\t}, {\n\t\t\"data\": \"meopham\",\n\t\t\"value\": \"Meopham\"\n\t}, {\n\t\t\"data\": \"minster\",\n\t\t\"value\": \"Minster\"\n\t}, {\n\t\t\"data\": \"mottingham\",\n\t\t\"value\": \"Mottingham\"\n\t}, {\n\t\t\"data\": \"new_beckenham\",\n\t\t\"value\": \"New Beckenham\"\n\t}, {\n\t\t\"data\": \"new_cross\",\n\t\t\"value\": \"New Cross\"\n\t}, {\n\t\t\"data\": \"new_eltham\",\n\t\t\"value\": \"New Eltham\"\n\t}, {\n\t\t\"data\": \"new_hythe\",\n\t\t\"value\": \"New Hythe\"\n\t}, {\n\t\t\"data\": \"newington\",\n\t\t\"value\": \"Newington\"\n\t}, {\n\t\t\"data\": \"northfleet\",\n\t\t\"value\": \"Northfleet\"\n\t}, {\n\t\t\"data\": \"nunhead\",\n\t\t\"value\": \"Nunhead\"\n\t}, {\n\t\t\"data\": \"orpington\",\n\t\t\"value\": \"Orpington\"\n\t}, {\n\t\t\"data\": \"otford\",\n\t\t\"value\": \"Otford\"\n\t}, {\n\t\t\"data\": \"paddock_wood\",\n\t\t\"value\": \"Paddock Wood\"\n\t}, {\n\t\t\"data\": \"penge_east\",\n\t\t\"value\": \"Penge East\"\n\t}, {\n\t\t\"data\": \"petts_wood\",\n\t\t\"value\": \"Petts Wood\"\n\t}, {\n\t\t\"data\": \"pluckley\",\n\t\t\"value\": \"Pluckley\"\n\t}, {\n\t\t\"data\": \"plumstead\",\n\t\t\"value\": \"Plumstead\"\n\t}, {\n\t\t\"data\": \"queensborough\",\n\t\t\"value\": \"Queensborough\"\n\t}, {\n\t\t\"data\": \"rainham\",\n\t\t\"value\": \"Rainham\"\n\t}, {\n\t\t\"data\": \"ramsgate\",\n\t\t\"value\": \"Ramsgate\"\n\t}, {\n\t\t\"data\": \"robertsbridge\",\n\t\t\"value\": \"Robertsbridge\"\n\t}, {\n\t\t\"data\": \"rochester\",\n\t\t\"value\": \"Rochester\"\n\t}, {\n\t\t\"data\": \"sandling\",\n\t\t\"value\": \"Sandling\"\n\t}, {\n\t\t\"data\": \"sandwich\",\n\t\t\"value\": \"Sandwich\"\n\t}, {\n\t\t\"data\": \"selling\",\n\t\t\"value\": \"Selling\"\n\t}, {\n\t\t\"data\": \"sevenoaks\",\n\t\t\"value\": \"Sevenoaks\"\n\t}, {\n\t\t\"data\": \"sheerness\",\n\t\t\"value\": \"Sheerness\"\n\t}, {\n\t\t\"data\": \"sheperdswell\",\n\t\t\"value\": \"Sheperdswell\"\n\t}, {\n\t\t\"data\": \"sidcup\",\n\t\t\"value\": \"Sidcup\"\n\t}, {\n\t\t\"data\": \"sittingbourne\",\n\t\t\"value\": \"Sittingbourne\"\n\t}, {\n\t\t\"data\": \"slade_green\",\n\t\t\"value\": \"Slade Green\"\n\t}, {\n\t\t\"data\": \"snodland\",\n\t\t\"value\": \"Snodland\"\n\t}, {\n\t\t\"data\": \"snowdown\",\n\t\t\"value\": \"Snowdown\"\n\t}, {\n\t\t\"data\": \"sole_street\",\n\t\t\"value\": \"Sole Street\"\n\t}, {\n\t\t\"data\": \"st_johns\",\n\t\t\"value\": \"St Johns\"\n\t}, {\n\t\t\"data\": \"st_leonards_warrior_square\",\n\t\t\"value\": \"St Leonards Warrior Square\"\n\t}, {\n\t\t\"data\": \"st_mary_cray\",\n\t\t\"value\": \"St Mary Cray\"\n\t}, {\n\t\t\"data\": \"st_pancras\",\n\t\t\"value\": \"St Pancras\"\n\t}, {\n\t\t\"data\": \"staplehurst\",\n\t\t\"value\": \"Staplehurst\"\n\t}, {\n\t\t\"data\": \"stone_crossing\",\n\t\t\"value\": \"Stone Crossing\"\n\t}, {\n\t\t\"data\": \"stonegate\",\n\t\t\"value\": \"Stonegate\"\n\t}, {\n\t\t\"data\": \"stratford_international\",\n\t\t\"value\": \"Stratford International\"\n\t}, {\n\t\t\"data\": \"strood\",\n\t\t\"value\": \"Strood\"\n\t}, {\n\t\t\"data\": \"sturry\",\n\t\t\"value\": \"Sturry\"\n\t}, {\n\t\t\"data\": \"sundridge_park\",\n\t\t\"value\": \"Sundridge Park\"\n\t}, {\n\t\t\"data\": \"swale\",\n\t\t\"value\": \"Swale\"\n\t}, {\n\t\t\"data\": \"swanley\",\n\t\t\"value\": \"Swanley\"\n\t}, {\n\t\t\"data\": \"swanscombe\",\n\t\t\"value\": \"Swanscombe\"\n\t}, {\n\t\t\"data\": \"sydenham_hill\",\n\t\t\"value\": \"Sydenham Hill\"\n\t}, {\n\t\t\"data\": \"teynham\",\n\t\t\"value\": \"Teynham\"\n\t}, {\n\t\t\"data\": \"tonbridge\",\n\t\t\"value\": \"Tonbridge\"\n\t}, {\n\t\t\"data\": \"tunbridge_wells\",\n\t\t\"value\": \"Tunbridge Wells\"\n\t}, {\n\t\t\"data\": \"victoria\",\n\t\t\"value\": \"Victoria\"\n\t}, {\n\t\t\"data\": \"wadhurst\",\n\t\t\"value\": \"Wadhurst\"\n\t}, {\n\t\t\"data\": \"walmer\",\n\t\t\"value\": \"Walmer\"\n\t}, {\n\t\t\"data\": \"wateringbury\",\n\t\t\"value\": \"Wateringbury\"\n\t}, {\n\t\t\"data\": \"waterloo_east\",\n\t\t\"value\": \"Waterloo East\"\n\t}, {\n\t\t\"data\": \"welling\",\n\t\t\"value\": \"Welling\"\n\t}, {\n\t\t\"data\": \"west_dulwich\",\n\t\t\"value\": \"West Dulwich\"\n\t}, {\n\t\t\"data\": \"west_malling\",\n\t\t\"value\": \"West Malling\"\n\t}, {\n\t\t\"data\": \"west_st_leonards\",\n\t\t\"value\": \"West St Leonards\"\n\t}, {\n\t\t\"data\": \"west_wickham\",\n\t\t\"value\": \"West Wickham\"\n\t}, {\n\t\t\"data\": \"westcombe_park\",\n\t\t\"value\": \"Westcombe Park\"\n\t}, {\n\t\t\"data\": \"westenhanger\",\n\t\t\"value\": \"Westenhanger\"\n\t}, {\n\t\t\"data\": \"westgate_on_sea\",\n\t\t\"value\": \"Westgate On Sea\"\n\t}, {\n\t\t\"data\": \"whitstable\",\n\t\t\"value\": \"Whitstable\"\n\t}, {\n\t\t\"data\": \"woolwich_arsenal\",\n\t\t\"value\": \"Woolwich Arsenal\"\n\t}, {\n\t\t\"data\": \"woolwich_dockyard\",\n\t\t\"value\": \"Woolwich Dockyard\"\n\t}, {\n\t\t\"data\": \"wye\",\n\t\t\"value\": \"Wye\"\n\t}, {\n\t\t\"data\": \"yalding\",\n\t\t\"value\": \"Yalding\"\n\t}]\n  \n  // setup autocomplete function pulling from stations[] array\n  jQuery('#autocomplete').autocomplete({\n    lookup: stations,\n    onSelect: function (suggestion) {\n      cti.store.variables.selectedStation = suggestion.data;\n      cti.utils.updatePage();\n    }\n  });\n});","_auto_id_":"5752f653-27b3-43ca-8546-959f31f8f7d9"},{"name":"setupApp","type":"script","item-type":"function","params":[],"content":"console.log(\"AZURE ID:\", cti.store.variables.azureId);\nif (cti.store.variables.azureId === undefined) {\n\tcti.store.variables.azureId = \"undefined\";\n}\n","_auto_id_":"1bea2862-642f-4a80-a25e-8a6311e829ec"},{"name":"photo_panel_open","type":"script","item-type":"variable","variable-type":"boolean","_auto_id_":"1b6d5adc-4c11-494c-9a9c-aad72f5ff835"},{"name":"audio_panel_open","type":"script","item-type":"variable","variable-type":"boolean","_auto_id_":"f5122b76-e16d-4107-9f6c-b237ad096548"},{"name":"msg_panel_open","type":"script","item-type":"variable","variable-type":"boolean","_auto_id_":"d628edd5-e2e0-44ca-b9b1-514b2bac6b90"},{"name":"start_flag","type":"script","item-type":"variable","variable-type":"boolean","_auto_id_":"c2bfd248-0030-4229-b9a8-59e557f9e3a8"},{"name":"login_error","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"44f3d4cb-6dd2-400f-a8db-c3ffff050c89"},{"name":"DND_clock","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"afe0545f-a551-4497-94c2-324db24a585f"},{"name":"Dont_Disturb","type":"notification","item-type":"app-notification","options":{},"style":"success","_auto_id_":"482ac8ee-88e0-47f8-bb04-e8574aa3a875"},{"name":"dont_disturb_off","type":"notification","item-type":"app-notification","options":{},"style":"warning","_auto_id_":"721fb11e-bb9c-4118-948c-f7c4288ac779"},{"name":"loading_spinner","type":"script","item-type":"variable","variable-type":"boolean","value":"false","_auto_id_":"6338f128-c2c4-41ea-acae-b448771f954c"},{"name":"azureId","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"4adaedcf-f6dd-49c3-98d6-c0049d8e4fe8"},{"name":"loggedInUser","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"7510776e-100e-43b2-b9b5-cc35a737280d"},{"name":"loggedInPassword","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"cb50365c-7b97-4a8e-8812-3972b3f50548"},{"name":"currentContact","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"668be96f-32b7-4d85-bfec-abffb55dbc2b"},{"name":"currentStation","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"db3fb9a3-6251-469b-9de7-a5eace13cdd5"},{"name":"selectedStation","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"1d29f2c4-d980-49d3-8b9f-b9c3a0196e42"},{"name":"currentAudio","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"7c3b1f8b-7e28-4ec6-82be-f478a7f87eb7"},{"name":"currentImage","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"300f3dc2-2089-4c8f-af51-5b99f302e438"},{"name":"getTokenExpiry","type":"script","item-type":"function","params":[{"name":"mins","description":"The number of minutes."}],"content":"var expiry = new Date();\n    expiry.setMinutes(expiry.getMinutes() + mins);\n    return Date.UTC(\n      expiry.getUTCFullYear(),\n      expiry.getUTCMonth(),\n      expiry.getUTCDate(),\n      expiry.getUTCHours(),\n      expiry.getUTCMinutes(),\n      expiry.getUTCSeconds()\n    ) / 1000;","_auto_id_":"db591968-ef32-4777-8aee-9d793be57614"},{"name":"generateSasToken","type":"script","item-type":"function","params":[],"content":"var hubUri = \"https://xmpp-ns.servicebus.windows.net/xmpp-hub\";\nvar SHARED_ACCESS_KEY = \"wx1bmhoiVTXunTXt8LWqj6jC9fXep+lemrXArAfEPV8=\";\nvar SHARED_ACCESS_KEY_NAME = \"DefaultListenSharedAccessSignature\";\n\nvar targetUri = encodeURIComponent(hubUri).toLowerCase();\nvar expiry = cti.getTokenExpiry(10);\nvar toSign = targetUri + \"\\n\" + expiry;\nvar signature = CryptoJS.HmacSHA256(toSign, SHARED_ACCESS_KEY);\nvar base64signature = signature.toString(CryptoJS.enc.Base64);\nvar base64UriEncoded = encodeURIComponent(base64signature);\nreturn \"SharedAccessSignature sr=\" + targetUri + \"&sig=\" + base64UriEncoded + \"&se=\" + expiry + \"&skn=\" + SHARED_ACCESS_KEY_NAME;","_auto_id_":"8f9a947b-deb3-4c6a-b1a4-47f35b22ca26"},{"name":"XMPP_LoginOutcome","type":"script","item-type":"function","params":[],"content":"\nfunction app_Notification(text, title, style){\nswitch(style){\n  case \"success\":  \ncti.utils.callAction(\n        \"show-notification\",\n        {\n          name: \"login_success\",\n          \"item-type\": \"app-notification\",\n          \"style\": style, //success/error/warning/info\n          title: title,\n          text: text\n       }\n\t );\n    break;\n  case \"error\": \ncti.utils.callAction(\n        \"show-notification\",\n        {\n          name: \"disconnected\",\n          \"item-type\": \"app-notification\",\n          \"style\": style, //success/error/warning/info\n          title: title,\n          text: text\n       }\n\t );\n    break;\n  default: break; \n}  \n}\n\nfunction clearInputEnteries(){\n\tcti.store.pages.Login.username = undefined;\n\tcti.store.pages.Login.password = undefined;\n}\n\nfunction gotoPage(pagename)\n{\n  cti.utils.callAction(\"go-to-page\",pagename);\n}\n\nswitch (cti.store.xmpp.southeastern.last_auth_status)\n{\n  case \"failed\": \n    app_Notification(\"Please check your credentials.\",\"Authentication Failed\",\"error\"); \n    cti.store.variables.loading_spinner = false;\n    break;\n  case \"success\": \n    app_Notification(\"Connected\", \"Login Success\", \"success\");\n\tclearInputEnteries();\n    gotoPage(\"Location\");\n    break;\n  default:\n    app_Notification(\"Please check your credentials and Internet connection.\",\"Login Failed\",\"error\"); \n    cti.store.variables.loading_spinner = false;\n    break;   \n}","_auto_id_":"03a12bd2-6e00-45d5-96bb-a8da92737ab7"},{"name":"registerWithHub","type":"script","item-type":"function","params":[],"sync":false,"content":"\nfunction app_notification(text,title,style){  \nswitch(style){\n  case \"error\":\n    {\n      cti.utils.callAction(\n        \"show-notification\",\n        {\n          name: \"disconnected\",\n          \"item-type\": \"app-notification\",\n          \"style\": style, //success/error/warning/info\n          title: title,\n          text: text\n       }\n\t );\n      break;\n    }\n  case \"info\": \n    {\n      cti.utils.callAction(\n        \"show-notification\",\n        {\n          name: \"login_initiated\",\n          \"item-type\": \"app-notification\",\n          \"style\": style, //success/error/warning/info\n          title: title,\n          text: text\n       }\n\t );\n      break;\n    }\n  default: break;\n}\n}\n\nfunction gotoPage(pagename)\n{\n  cti.utils.callAction(\"go-to-page\",pagename);\n}\n\n\nvar gcmRegistrationId = cti.store.notification.token;\nvar xhr = new XMLHttpRequest();\nvar scope = this;\n\nxhr.onreadystatechange = function () {\n  if (xhr.readyState === 4) {\n    if (xhr.status === 201) {\n      var location = xhr.getResponseHeader(\"Location\");\n      if (location !== null) {\n      \tvar azureRegistrationId = location.match(/registrationIDs\\/(.*)\\?/i)[1];\n      \tconsole.log(\"AZURE ID:\", azureRegistrationId);\n        cti.store.variables.azureId = azureRegistrationId;\n        cti.utils.updatePage();\n      \t//scope.$success(azureRegistrationId);\n        return;\n      } else {\n        app_notification( \"Couldn't get location header, CORS issues\",\"Azure Notification\", \"info\");\n        return;\n      \t//scope.$fail(\"Couldn't get location header, CORS issues?\");  \n      }\n    } else {\n     \n     app_notification(\"Azure registration failed\",\"Azure Notification\",\"info\");\n      return;\n     //scope.$fail(\"Azure registration failed\");\n    }\n  }\n};\n\nxhr.onerror = function () {\n  app_notification(\"Azure registration failed\",\"Azure Notification\",\"info\");\n  return;\n  //scope.$fail(\"Azure registration failed\");\n};\n\nif (cti.store.variables.azureId == \"undefined\") {\nconsole.log(\"REGISTERING\");\nxhr.open('POST', \"https://xmpp-ns.servicebus.windows.net/xmpp-hub/registrationIDs/?api-version=2015-01\", true);\nxhr.setRequestHeader(\"Content-Type\", \"application/atom+xml;type=entry;charset=utf-8\");\nxhr.setRequestHeader(\"Authorization\", cti.generateSasToken());\nxhr.setRequestHeader(\"x-ms-version\", \"2015-01\");\nxhr.send();\n}","_auto_id_":"657b564a-7ef4-450c-abfd-55919fe084a2"},{"name":"disconnected","type":"notification","item-type":"app-notification","options":{"progressBar":false},"style":"error","title":"You've been disconnected!","text":"Your connection to the CommonTime XMPP server has been terminated.","actions":[],"_auto_id_":"c0e1aded-e8aa-4a3a-96e1-0101f26a94b5"},{"name":"southeastern","type":"integration","item-type":"xmpp","actions":[{"event":"error","type":"inline-function","data":{"code":"console.log(cti.store.xmpp.southeastern.connection_status);"},"_auto_id_":"22e3b390-3424-4dd5-a4b3-3d1480dfed58"},{"event":"connection-failed","type":"if","data":{},"operations":[],"_auto_id_":"54e1c2cf-3325-46bb-88ce-55797bd136a5"},{"event":"connection-failed","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"authentication_fail","title":"Connection Failed.","text":"Unable to connect to the internet."},"_auto_id_":"8bced95d-8461-4edf-9a6e-ee36e8cff58e"},{"event":"connection-failed","type":"set-variable","data":{"name":"loading_spinner","value":"false"},"_auto_id_":"7a9f4ad9-89b8-418c-a737-cc32a91e52eb"},{"type":"end-if","data":{},"event":"connection-failed","_auto_id_":"8b485312-fbf8-4a92-bb16-5e7f98b2973d"},{"name":"call_function_2","event":"message-received","type":"call-function","data":{"name":"debug","params":{"data":"SHOW LOCAL NOTIFICATION!"}},"_auto_id_":"928a653a-30ba-488d-bdf6-f3ae398a9707"},{"name":"call_function_1","event":"disconnected","type":"call-function","data":{"name":"debug","params":{"data":"Disconnected."}},"_auto_id_":"81f618bd-0821-418a-9daa-0e1bdc8edf3e"},{"event":"message-received","type":"inline-function","data":{"sync":false,"code":"if($message === undefined) {\n  var $message = $data.$message;\n}\n\nconsole.log('Message Received:')\nconsole.log($message);\n\ncti.updateChatHistory($message);\ncti.updateThreadMessages();"},"_auto_id_":"9797a1b2-5a5a-4be1-be62-6f0e018d5afc"},{"name":"go_to_page_1","event":"disconnected","type":"go-to-page","data":"Login","_auto_id_":"4905b5f1-a5fc-4cc6-8ea3-418df21e9918"},{"event":"connection-failed","type":"go-to-page","data":"Login","_auto_id_":"f1590c97-aa14-45f2-9e42-ba8d4c9f88c1"},{"name":"show_notification_1","event":"message-received","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"new_message","title":"New message from: '{{$data.$message.from}}'","text":"{{$data.$message.body}}"},"_auto_id_":"5bb9bef3-a261-49a6-8909-89073157bffd"},{"event":"error","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"authentication_fail","title":"Error Event","text":"This message is shown when an XMPP error event occurs."},"_auto_id_":"a07d82e8-4d62-4724-bd41-bcc2148e69fc"}],"endpoint":"ws://lser-docker-dev.cloudapp.net:5280/websocket","upload-jid":"upload.southeasternrailway.co.uk","multicast-jid":"multicast.southeasternrailway.co.uk","stay-connected":false,"_auto_id_":"6a34b689-497d-4cbf-ac24-845492d42299","ping-time":5000},{"name":"debug","type":"script","item-type":"function","params":[{"name":"data"}],"content":"console.log(\"DATA:\", data);","_auto_id_":"7a2c0e22-8be2-460a-851b-5f369fb8dc8b"},{"name":"getUsernameFromTitle","type":"script","item-type":"function","params":[{"name":"text"}],"sync":true,"content":"\nthis.$successCallback(/'(.*)'/.exec(text)[1]);","_auto_id_":"8f528f49-5f3a-4e49-b44f-b4f2f12342ee"},{"name":"new_message","type":"notification","item-type":"device-notification","interactions":[{"text":false,"name":"dismiss","label":"Dismiss"},{"text":true,"name":"reply","label":"Reply"}],"actions":[{"name":"call_function_2","event":"reply-interaction-pressed","type":"call-function","data":{"name":"debug","params":{"data":"{{$notification}}"}},"_auto_id_":"3e8c2c81-7e53-4ff2-a74b-b5c70c69fecd"},{"name":"call_function_3","event":"reply-interaction-pressed","type":"call-function","data":{"name":"getUsernameFromTitle","params":{"text":"{{$notification.title}}"}},"_auto_id_":"4b770a32-6051-4005-8dc6-072f76efd631"},{"name":"call_function_1","event":"reply-interaction-pressed","type":"call-function","data":{"name":"debug","params":{"data":"{{$flow.call_function_3.success}}"}},"_auto_id_":"324cda67-a8a0-419f-a9cf-7f0774729f9a"},{"name":"call_function_4","event":"reply-interaction-pressed","type":"call-function","data":{"name":"debug","params":{"data":"{{$notification.actionResponse}}"}},"_auto_id_":"a741680b-1e0f-4310-84ad-05eb987f9f60"},{"name":"send_xmpp_message_1","event":"reply-interaction-pressed","type":"send-xmpp-message","data":{"to":"{{$flow.call_function_3.success}}","message":"{{$notification.actionResponse}}","name":"commontime","metadata":{}},"_auto_id_":"7653524c-e506-42d8-8b63-cf24087fed9f"}],"_auto_id_":"5fef5cef-1dbb-46f0-b5cc-a797dc5590a9"},{"name":"push_event_1","type":"notification","item-type":"push-event","operations":[{"type":"value","content":"{{$notification.payload.type}}"},{"type":"operator","content":"=="},{"type":"value","content":"xmpp_message"}],"actions":[{"name":"show_notification_1","event":"push-received","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"new_message","title":"New message from '{{$notification.payload.from}}'","text":"{{$notification.payload.body}}"},"_auto_id_":"ca51e2e5-6cc4-4ca4-a589-2fce5c47320e"}],"_auto_id_":"8bff0238-42b1-4818-9b89-430ada735f36"},{"name":"push_event_2","type":"notification","item-type":"push-event","operations":[{"type":"value","content":"123"},{"type":"operator","content":"=="},{"type":"value","content":"123"}],"actions":[{"name":"call_function_1","event":"push-received","type":"call-function","data":{"name":"debug","params":{"data":"{{$notification}}"}},"_auto_id_":"92436017-749a-4cbf-9542-c960397f0899"}],"_auto_id_":"34f114ac-1784-4506-b612-1dfe7d5e1910"},{"name":"azureUpdate","type":"script","item-type":"function","params":[{"name":"username","required":true}],"content":"\nfunction app_notification(text,title,style){\n  \nswitch(style){\n  case \"error\":\n    {\n      cti.utils.callAction(\n        \"show-notification\",\n        {\n          name: \"disconnected\",\n          \"item-type\": \"app-notification\",\n          \"style\": style, //success/error/warning/info\n          title: title,\n          text: text\n       }\n\t );\n      break;\n    }\n  case \"info\": \n    {\n      cti.utils.callAction(\n        \"show-notification\",\n        {\n          name: \"login_initiated\",\n          \"item-type\": \"app-notification\",\n          \"style\": style, //success/error/warning/info\n          title: title,\n          text: text\n       }\n\t );\n      break;\n    }\n  default: break;\n}\n}\n\nfunction gotoPage(pagename)\n{\n  cti.utils.callAction(\"go-to-page\",pagename);\n}\n\n\nvar scope = this, username = username.split(\"@\")[0];\nxhr = new XMLHttpRequest();\n\nxhr.onreadystatechange = function () {\n  if (xhr.readyState === 4) {\n    if (xhr.status === 200) {\n      console.log(\"SUCCESS!\");\n      return;\n      //scope.$success(\"Update Azure registration success!\");\n    } else {\n       app_notification(\"Update Azure registration failed.\", \"Azure Notification\",\"info\");\n      return;\n      //scope.$fail(\"Update Azure registration failed.\");\n    }\n  }\n};\nxhr.onerror = function () {\n  app_notification(\"Update Azure registration failed.\", \"Azure Notification\",\"info\");\n  return; \n  //scope.$fail(\"Update Azure registration failed.\");\n};\nif (cti.store.variables.azureId !== undefined && cti.store.variables.azureId !== \"undefined\") {\n  console.log('Updating Azure Registration...', username);\n  xhr.open('PUT', \"https://xmpp-ns.servicebus.windows.net/xmpp-hub/registrations/\" + cti.store.variables.azureId + \"?api-version=2015-01\", true);\n  xhr.setRequestHeader(\"Content-Type\", \"application/atom+xml;type=entry;charset=utf-8\");\n  xhr.setRequestHeader(\"Authorization\", cti.generateSasToken());\n  xhr.setRequestHeader(\"x-ms-version\", \"2015-01\");\n\n  var android = '<?xml version=\"1.0\" encoding=\"utf-8\"?><entry xmlns=\"http://www.w3.org/2005/Atom\"><content type=\"application/xml\"><GcmTemplateRegistrationDescription xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/netservices/2010/10/servicebus/connect\"><Tags>everyone,' + username + '</Tags><GcmRegistrationId>' + cti.store.notification.token + '</GcmRegistrationId><BodyTemplate><![CDATA[{\"data\":{\"message\":\"$(message)\",\"payload\": {\"type\": \"xmpp_message\", \"from\": \"$(sender)\", \"body\": \"$(body)\"}}}]]></BodyTemplate></GcmTemplateRegistrationDescription></content></entry>';\n\n  var ios = '<?xml version=\"1.0\" encoding=\"utf-8\"?><entry xmlns=\"http://www.w3.org/2005/Atom\"><content type=\"application/xml\"><AppleTemplateRegistrationDescription xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/netservices/2010/10/servicebus/connect\"><Tags>everyone,' + username + '</Tags><DeviceToken>' + cti.store.notification.token + '</DeviceToken><BodyTemplate><![CDATA[{\"aps\":{\"alert\":\"$(message)\"}, \"payload\": {\"type\": \"xmpp_message\", \"from\": \"$(sender)\", \"body\": \"$(body)\"}}]]></BodyTemplate></AppleTemplateRegistrationDescription></content></entry>';\n\n  var winphone = '<?xml version=\"1.0\" encoding=\"utf-8\"?><entry xmlns=\"http://www.w3.org/2005/Atom\"><content type=\"application/xml\"><WindowsTemplateRegistrationDescription xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/netservices/2010/10/servicebus/connect\"><Tags>everyone, ' + username + '</Tags><ChannelUri>' + cti.store.notification.token + '</ChannelUri><BodyTemplate><![CDATA[{\"aps\":{\"alert\":\"$(message)\"}, \"payload\": {\"type\": \"xmpp_message\", \"from\": \"$(sender)\", \"body\": \"$(body)\"}}]]></BodyTemplate></WindowsTemplateRegistrationDescription></content></entry>';\n\n  var xml = null;\n  switch (cti.store.env.platform.name) {\n    case \"android\":\n      xml = android;\n      break;\n    case \"ios\":\n      xml = ios;\n      break;\n    case \"winphone\":\n      xml = winphone;\n      break;\n  }\n  if (xml !== null) {\n      xhr.send(xml);\n  } else {\n      app_notification(\"Push is not available for this platform.\", \"Azure Notification\", \"info\");\n    return;\n      //scope.$success(\"Push is not available for this platform.\");  \n  }\n} else {\n  app_notification(\"Couldn't get registration ID from previous request.\", \"Azure Notification\", \"info\");\n  return;\n  //scope.$fail(\"Couldn't get registration ID from previous request.\");  \n}","sync":false,"_auto_id_":"40cade99-1c02-45de-8ca1-96b551f292a7"},{"name":"login_initiated","type":"notification","item-type":"app-notification","options":{},"style":"info","_auto_id_":"aab4f534-2f05-44f9-8141-d7121efc3390"},{"name":"audio_enabled","type":"script","item-type":"variable","variable-type":"boolean","_auto_id_":"0a77c05a-2fc6-47aa-b315-e40965a6e88a"},{"name":"message_enabled","type":"script","item-type":"variable","variable-type":"boolean","_auto_id_":"95698797-f5fb-474d-9aa5-b8267dada383"},{"name":"photo_enabled","type":"script","item-type":"variable","variable-type":"boolean","_auto_id_":"9fb3457c-b827-4b27-9d27-8c686b0d954d"},{"name":"authentication_fail","type":"notification","item-type":"app-notification","options":{},"style":"error","actions":[],"_auto_id_":"4d46877d-d396-4d2a-a4f4-66a46c4ee971"},{"name":"login_success","type":"notification","item-type":"app-notification","options":{},"style":"success","actions":[],"_auto_id_":"7e87bde1-7ac7-4170-a627-c6940fb9048c"},{"name":"confirmMessage","type":"script","item-type":"function","params":[{"name":"$element"}],"content":"var data = $element;\n\nvar item = data.getAttribute(\"item\"); \nitem = (JSON.parse(item));\n\nvar id = item.id;\nconsole.log(id);\n\n/* Call XMPP Mark Acknowledged message to expire the messsage */\ncti.utils.callAction(\"xmpp-mark-acknowledged\",\n{ \"name\": \"southeastern\", \"id\": item.id }\n);\n","_auto_id_":"c2e8324d-8886-4228-8b3d-bd420c9a64fc"},{"name":"imageView","type":"script","item-type":"function","params":[{"name":"$element"}],"content":"var data = $element;\n\nvar item = data.getAttribute(\"item\"); \nitem = (JSON.parse(item));\n\nvar photo = item.original[0].media.local;\ncti.store.variables.currentImage = photo;\n\ncti.utils.callAction(\"go-to-page\", \"Msg_View\");","_auto_id_":"f3e1d5e3-bcc6-4b65-80ab-6d6770e34a9d"},{"name":"allMessages","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"da781a1e-30bb-4e5c-81d8-9add3c0001bc"},{"name":"responseRequired","type":"script","item-type":"variable","variable-type":"string","value":"true","_auto_id_":"247b3815-0e73-4f89-b1a0-a4a3bc945f5f"},{"name":"audioShow","type":"script","item-type":"variable","variable-type":"boolean","value":"false","_auto_id_":"891444f7-1165-42ca-833c-9befae44c58f"},{"name":"imageShow","type":"script","item-type":"variable","variable-type":"boolean","value":"false","_auto_id_":"5451682b-91f3-41be-a01f-be50c09a51d0"},{"name":"messageShow","type":"script","item-type":"variable","variable-type":"boolean","value":"false","_auto_id_":"113602b0-9ab5-40e0-81c3-26bd9017ffc2"},{"name":"show_mic_icon","type":"script","item-type":"variable","variable-type":"boolean","_auto_id_":"d6b7c98c-9de7-44d1-a086-af79501873ea"},{"name":"recording_animation","type":"script","item-type":"variable","variable-type":"boolean","_auto_id_":"6fb7eaa4-368a-4b8e-8aee-8f2460e3710c"},{"name":"audioRecordedShow","type":"script","item-type":"variable","variable-type":"boolean","value":"false","_auto_id_":"0395ea5d-c823-4a35-b2d5-b8dfba6fb0c3"},{"name":"recordingFlag","type":"script","item-type":"variable","variable-type":"boolean","value":"false","_auto_id_":"c2f3dc06-141e-4603-824a-4a2283f178d3"},{"name":"recording_clock","type":"script","item-type":"variable","variable-type":"string","_auto_id_":"6dfbc246-b589-4f92-8883-8733dc842014"}],"components":[{"content":"InVzZSBzdHJpY3QiOwoKdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCJ2YWx1ZSIgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCnZhciBDVFBvcHVwQm94ID0gKGZ1bmN0aW9uIChfSFRNTEVsZW1lbnQpIHsKCV9pbmhlcml0cyhDVFBvcHVwQm94LCBfSFRNTEVsZW1lbnQpOwoKCWZ1bmN0aW9uIENUUG9wdXBCb3goKSB7CgkJX2NsYXNzQ2FsbENoZWNrKHRoaXMsIF9DVFBvcHVwQm94KTsKCgkJX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoX0NUUG9wdXBCb3gucHJvdG90eXBlKSwgImNvbnN0cnVjdG9yIiwgdGhpcykuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCX0KCglfY3JlYXRlQ2xhc3MoQ1RQb3B1cEJveCwgW3sKCQlrZXk6ICJhdHRhY2hlZENhbGxiYWNrIiwKCQl2YWx1ZTogZnVuY3Rpb24gYXR0YWNoZWRDYWxsYmFjaygpIHsKCQkJdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQljb250YWluZXIuY2xhc3NOYW1lID0gJ3BvcHVwQkcnOwoJCQljb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCgkJCXZhciBwb3B1cEJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlwb3B1cEJveC5jbGFzc05hbWUgPSAncG9wdXBCb3gnOwoKCQkJd2hpbGUgKHRoaXMuY2hpbGROb2Rlcy5sZW5ndGggIT09IDApIHsKCQkJCXBvcHVwQm94LmFwcGVuZENoaWxkKHRoaXMuY2hpbGROb2Rlc1swXSk7CgkJCX0KCgkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChwb3B1cEJveCk7CgkJCXRoaXMuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTsKCQkJdGhpcy5vcGVuZWQgPSBmYWxzZTsKCQkJdGhpcy5pZCA9IHRoaXMuZ2V0QXR0cmlidXRlKCJpZCIpOwoJCX0KCgkJLy8gVG9nZ2xlcyB0aGUgbWVudSBvcGVuZWQgYW5kIGNsb3NlZCBiYXNlZCBvbiB0aGUgdmFsdWUKCQkvLyBvZiB0aGUgdGhpcy5vcGVuZWQgcHJvcGVydHkgKGluaXRpYWxseSBzZXQgdG8gZmFsc2UpCgl9LCB7CgkJa2V5OiAidG9nZ2xlUG9wdXAiLAoJCXZhbHVlOiBmdW5jdGlvbiB0b2dnbGVQb3B1cCgpIHsKCQkJdmFyIGNvbnRleHRNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY3QtcG9wdXAtYm94IycgKyB0aGlzLmlkICsgJyA+IC5wb3B1cEJHJyk7CgoJCQlpZiAoIXRoaXMub3BlbmVkKSB7CgkJCQl0aGlzLm9wZW5lZCA9IHRydWU7CgkJCQkvL2NvbnRleHRNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbG9zZU1lbnUsIHRydWUpOwoJCQkJY29udGV4dE1lbnUuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKCQkJfSBlbHNlIHsKCQkJCXRoaXMub3BlbmVkID0gZmFsc2U7CgkJCQkvL2NvbnRleHRNZW51LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbG9zZU1lbnUpOwoJCQkJY29udGV4dE1lbnUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJfQoJCX0KCX1dKTsKCgl2YXIgX0NUUG9wdXBCb3ggPSBDVFBvcHVwQm94OwoJQ1RQb3B1cEJveCA9IFdlYkNvbXBvbmVudHMuYW5ub3RhdGUoewoJCSJhdHRyaWJ1dGVzIjogewoJCQkicHJvcGVydGllcyI6IHsKCQkJCSJpZCI6IHsKCQkJCQkidHlwZSI6ICJzdHJpbmciCgkJCQl9CgkJCX0sCgkJCSJyZXF1aXJlZCI6IFsiaWQiXQoJCX0sCgkJImNvbnRhaW5lciI6IHRydWUKCX0pKENUUG9wdXBCb3gpIHx8IENUUG9wdXBCb3g7CglyZXR1cm4gQ1RQb3B1cEJveDsKfSkoSFRNTEVsZW1lbnQpOwoKZG9jdW1lbnQucmVnaXN0ZXJFbGVtZW50KCdjdC1wb3B1cC1ib3gnLCBDVFBvcHVwQm94KTs=","type":"web-component-es2015","element":"ct-popup-box","usage":"<ct-popup-box></ct-popup-box>","name":"ct_popup_box"}],"metadata":{},"splashdata":{},"splash":"default","workflows":[],"icondata":"LSER_ESIA_App_Icon.png","language":{"defaultLocale":"en_GB","initialLanguage":"","useDeviceLocale":true},"actionflows":[],"dataflows":[],"schemaVersion":5,"lastSchemaUpgradeDate":"Mon Sep 05 2016 11:04:37 GMT+0100 (GMT Summer Time)","hostContext":0}